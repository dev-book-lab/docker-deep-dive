# 03. containerd - ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì˜ í•µì‹¬

## ğŸ¯ ì´ ì±•í„°ì—ì„œ ë°°ìš¸ ê²ƒ

- **containerd vs dockerd**: ì—­í•  ì°¨ì´ì™€ ì•„í‚¤í…ì²˜
- **ctr ëª…ë ¹ì–´**: containerdë¥¼ ì§ì ‘ ì œì–´í•˜ëŠ” CLI
- **Namespace**: containerdì˜ ë©€í‹°í…Œë„Œì‹œ êµ¬í˜„
- **Content Store**: ì´ë¯¸ì§€ ë ˆì´ì–´ì˜ ì €ì¥ ë°©ì‹
- **Snapshot**: ì»¨í…Œì´ë„ˆ íŒŒì¼ì‹œìŠ¤í…œ ê´€ë¦¬
- **Task**: ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ì œì–´

## ğŸ“Œ ì™œ ì¤‘ìš”í•œê°€?

**"containerdë¥¼ ì´í•´í•˜ë©´ Dockerì™€ Kubernetesì˜ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜ì„ ëª¨ë‘ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."**

```
containerdì˜ ìœ„ì¹˜:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ High-level Tools (ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤)                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Docker  â”‚    â”‚ Podman   â”‚    â”‚Kubernetesâ”‚               â”‚
â”‚  â”‚  CLI     â”‚    â”‚          â”‚    â”‚  kubelet â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚               â”‚               â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dockerd         (ì„ íƒì )        CRI Plugin                    â”‚
â”‚   â”‚                                â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â† ì´ ì±•í„°ì˜ í•µì‹¬!    â”‚
â”‚        â”‚      containerd          â”‚                         â”‚
â”‚        â”‚  - Image Management      â”‚                         â”‚
â”‚        â”‚  - Container Lifecycle   â”‚                         â”‚
â”‚        â”‚  - Snapshot Management   â”‚                         â”‚
â”‚        â”‚  - Content Store         â”‚                         â”‚
â”‚        â”‚  - Task Management       â”‚                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                     â”‚                                       â”‚
â”‚                     â”‚ OCI Runtime API                       â”‚
â”‚                     â–¼                                       â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚        â”‚    runc / crun           â”‚                         â”‚
â”‚        â”‚  (Low-level Runtime)     â”‚                         â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

containerdê°€ í•˜ëŠ” ì¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê¸°ëŠ¥            â”‚ ì„¤ëª…                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Image          â”‚ Registryì—ì„œ pull/push                â”‚
â”‚ Management     â”‚ ì´ë¯¸ì§€ ì €ì¥, ë©”íƒ€ë°ì´í„° ê´€ë¦¬                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Container      â”‚ ì»¨í…Œì´ë„ˆ ìƒì„±, ì‹œì‘, ì •ì§€                  â”‚
â”‚ Lifecycle      â”‚ runcë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì œ ì‹¤í–‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Snapshot       â”‚ ì»¨í…Œì´ë„ˆ íŒŒì¼ì‹œìŠ¤í…œ ì¤€ë¹„                   â”‚
â”‚                â”‚ Copy-on-Write êµ¬í˜„                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content Store  â”‚ ë ˆì´ì–´ blob ì €ì¥ (Content-addressable)  â”‚
â”‚                â”‚ SHA256 ê¸°ë°˜ ì¤‘ë³µ ì œê±°                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Namespace      â”‚ ë©€í‹°í…Œë„Œì‹œ ê²©ë¦¬                          â”‚
â”‚ Isolation      â”‚ Docker, k8sê°€ ê°ê° ë‹¤ë¥¸ namespace ì‚¬ìš©   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker vs containerd:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Before (Docker CLI)â”‚     â”‚ After (ctr CLI)   â”‚
â”‚                   â”‚     â”‚                   â”‚
â”‚ docker run nginx  â”‚     â”‚ ctr run nginx     â”‚
â”‚        â”‚          â”‚     â”‚        â”‚          â”‚
â”‚        â–¼          â”‚     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚     dockerd       â”‚     â”‚                  â”‚â”‚
â”‚        â”‚          â”‚     â”‚                  â”‚â”‚
â”‚ - ë„¤íŠ¸ì›Œí¬ ìƒì„±      â”‚     â”‚    (ì§ì ‘ ì‹¤í–‰)      â”‚â”‚
â”‚ - ë³¼ë¥¨ ë§ˆìš´íŠ¸        â”‚     â”‚                  â”‚â”‚
â”‚ - ë¡œê·¸ ìˆ˜ì§‘         â”‚     â”‚  âŒ ë„¤íŠ¸ì›Œí¬ ì—†ìŒ    â”‚â”‚
â”‚ - ì¬ì‹œì‘ ì •ì±…        â”‚     â”‚  âŒ ë³¼ë¥¨ ìë™ ì—†    â”‚â”‚
â”‚        â”‚          â”‚     â”‚  âŒ ë¡œê·¸ ìˆ˜ì§‘ ì—†ìŒ   â”‚â”‚
â”‚        â–¼          â”‚     â”‚  âŒ ì¬ì‹œì‘ ì—†ìŒ     â”‚â”‚
â”‚   containerd      â”‚     â”‚        â”‚          â”‚â”‚
â”‚        â”‚          â”‚     â”‚        â–¼          â”‚â”‚
â”‚        â–¼          â”‚     â”‚   containerd      â”‚â”‚
â”‚     runc          â”‚     â”‚        â”‚          â”‚â”‚
â”‚                   â”‚     â”‚        â–¼          â”‚â”‚
â”‚ âœ… í¸ë¦¬í•¨           â”‚     â”‚     runc          â”‚â”‚
â”‚ âŒ ì¶”ìƒí™” ê³„ì¸µ ë§ìŒ   â”‚     â”‚                   â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ âœ… ë¹ ë¦„/ì§ì ‘ ì œì–´    â”‚â”‚
                          â”‚ âŒ ìˆ˜ë™ ì„¤ì • í•„ìš”    â”‚â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì‹¤ë¬´ ì˜í–¥:**
- **Kubernetes CRI ì´í•´**: kubeletì´ containerdë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ê°€
- **Docker ë…ë¦½ì„±**: Docker ì—†ì´ë„ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ê°€ëŠ¥
- **ë””ë²„ê¹…**: Docker ë¬¸ì œ ë°œìƒ ì‹œ containerd ë ˆë²¨ì—ì„œ ì§„ë‹¨
- **ì„±ëŠ¥**: Dockerë³´ë‹¤ ê°€ë²¼ìš´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™˜ê²½

---

## ğŸ”¬ Deep Dive

### 1. containerd ì•„í‚¤í…ì²˜

#### ë‚´ë¶€ êµ¬ì¡°

```
containerd ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        containerd                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ gRPC API Serverâ”‚  â”‚   CRI Plugin   â”‚  â”‚  ctr (CLI)    â”‚  â”‚
â”‚  â”‚ (Unix Socket)  â”‚  â”‚  (Kubernetes)  â”‚  â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                   â”‚                   â”‚          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Core Services                           â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚   Images    â”‚  â”‚  Containers â”‚  â”‚    Tasks    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - Pull/Push â”‚  â”‚ - Metadata  â”‚  â”‚ - Process   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - List      â”‚  â”‚ - Create    â”‚  â”‚ - Start/Stopâ”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - Delete    â”‚  â”‚ - Delete    â”‚  â”‚ - Kill      â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚         â”‚                â”‚                â”‚          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                â”‚                â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Content Store  â”‚  â”‚  Snapshots  â”‚  â”‚   Runtime   â”‚       â”‚
â”‚  â”‚                â”‚  â”‚             â”‚  â”‚             â”‚       â”‚
â”‚  â”‚ - Blob ì €ì¥     â”‚  â”‚ - Overlay2  â”‚  â”‚ - runc      â”‚       â”‚
â”‚  â”‚ - SHA256 ê²€ì¦   â”‚  â”‚ - Btrfs     â”‚  â”‚ - crun      â”‚       â”‚
â”‚  â”‚ - ì¤‘ë³µ ì œê±°      â”‚  â”‚ - ZFS       â”‚  â”‚ - kata      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë°ì´í„° ì €ì¥ ìœ„ì¹˜:
/var/lib/containerd/
â”œâ”€â”€ io.containerd.content.v1.content/     â† Content Store
â”‚   â””â”€â”€ blobs/sha256/                     (ì´ë¯¸ì§€ ë ˆì´ì–´ blob)
â”‚       â”œâ”€â”€ a3ed95...
â”‚       â””â”€â”€ 9f13e0...
â”‚
â”œâ”€â”€ io.containerd.metadata.v1.bolt/       â† Metadata DB
â”‚   â””â”€â”€ meta.db                           (ì´ë¯¸ì§€/ì»¨í…Œì´ë„ˆ ì •ë³´)
â”‚
â”œâ”€â”€ io.containerd.snapshotter.v1.overlayfs/ â† Snapshots
â”‚   â””â”€â”€ snapshots/                        (ì»¨í…Œì´ë„ˆ íŒŒì¼ì‹œìŠ¤í…œ)
â”‚       â”œâ”€â”€ 1/
â”‚       â”œâ”€â”€ 2/
â”‚       â””â”€â”€ 3/
â”‚
â””â”€â”€ io.containerd.runtime.v2.task/        â† Runtime State
    â””â”€â”€ default/                          (ì‹¤í–‰ ì¤‘ì¸ Task)
        â””â”€â”€ mycontainer/
            â”œâ”€â”€ config.json
            â””â”€â”€ rootfs/
```

#### Namespaceì˜ ì—­í• 

```
Namespace: containerdì˜ ë©€í‹°í…Œë„Œì‹œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     containerd                            â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Namespace: "moby" (Dockerê°€ ì‚¬ìš©)                  â”‚     â”‚
â”‚  â”‚  - Images: nginx, redis, postgres                â”‚     â”‚
â”‚  â”‚  - Containers: web-1, db-1, cache-1              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Namespace: "k8s.io" (Kubernetesê°€ ì‚¬ìš©)            â”‚     â”‚
â”‚  â”‚  - Images: pause, coredns, kube-proxy            â”‚     â”‚
â”‚  â”‚  - Containers: pod-1, pod-2, pod-3               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Namespace: "default" (ctr ê¸°ë³¸ namespace)         â”‚     â”‚
â”‚  â”‚  - Images: alpine, ubuntu                        â”‚     â”‚
â”‚  â”‚  - Containers: test-1, debug-1                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Namespace ê²©ë¦¬:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëª…ë ¹ì–´            â”‚ ê²°ê³¼                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ctr -n moby     â”‚ Dockerê°€ ê´€ë¦¬í•˜ëŠ” ì»¨í…Œì´ë„ˆë§Œ ë³´ì„           â”‚
â”‚ image ls        â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ctr -n k8s.io   â”‚ Kubernetesê°€ ê´€ë¦¬í•˜ëŠ” ì»¨í…Œì´ë„ˆë§Œ ë³´ì„       â”‚
â”‚ container ls    â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ctr image ls    â”‚ default namespace (ë…ë¦½ëœ ê³µê°„)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â— ì£¼ì˜: Dockerì˜ ì»¨í…Œì´ë„ˆëŠ” "moby" namespaceì— ìˆìŒ
         ctr -n moby container ls  â† Docker ì»¨í…Œì´ë„ˆ í™•ì¸
```

---

### 2. Content Store ì´í•´

#### Content-Addressable Storage

```
Content Store: ëª¨ë“  ë°ì´í„°ë¥¼ SHA256 í•´ì‹œë¡œ ê´€ë¦¬

ê°œë…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Content Store (ë¶ˆë³€ ì €ì¥ì†Œ)                               â”‚
â”‚                                                        â”‚
â”‚  íŒŒì¼ ì €ì¥:                                              â”‚
â”‚  1. íŒŒì¼ ë‚´ìš©ì˜ SHA256 í•´ì‹œ ê³„ì‚°                            â”‚
â”‚  2. í•´ì‹œë¥¼ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥                                  â”‚
â”‚  3. ê°™ì€ ë‚´ìš© = ê°™ì€ í•´ì‹œ = ì €ì¥ 1íšŒ                         â”‚
â”‚                                                        â”‚
â”‚  /var/lib/containerd/io.containerd.content.v1.content/ â”‚
â”‚  â””â”€â”€ blobs/sha256/                                     â”‚
â”‚      â”œâ”€â”€ a3ed95...  â† ë‚´ìš© A                            â”‚
â”‚      â”œâ”€â”€ 9f13e0...  â† ë‚´ìš© B                            â”‚
â”‚      â””â”€â”€ a3ed95...  â† ë‚´ìš© Aì™€ ë™ì¼ (ì¤‘ë³µ ì €ì¥ ì•ˆ ë¨)        â”‚
â”‚                                                        â”‚
â”‚  ì¥ì :                                                  â”‚
â”‚  âœ… ì¤‘ë³µ ì œê±° (Deduplication)                            â”‚
â”‚  âœ… ë¬´ê²°ì„± ê²€ì¦ (SHA256ìœ¼ë¡œ í™•ì¸)                           â”‚
â”‚  âœ… ë³‘ë ¬ ë‹¤ìš´ë¡œë“œ (ë ˆì´ì–´ë³„ ë…ë¦½)                             â”‚
â”‚  âœ… ë ˆì´ì–´ ê³µìœ  (ì—¬ëŸ¬ ì´ë¯¸ì§€ê°€ ê°™ì€ base ì‚¬ìš©)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‹¤ì œ ì˜ˆì‹œ:
Image A: alpine + nginx        Image B: alpine + redis
â””â”€â”€ sha256:a3ed95... (alpine)  â””â”€â”€ sha256:a3ed95... (alpine)
    sha256:9f13e0... (nginx)       sha256:1b2c3d... (redis)

Content Storeì— ì €ì¥ëœ blob:
- sha256:a3ed95...  â† 1ë²ˆë§Œ ì €ì¥ (A, Bê°€ ê³µìœ )
- sha256:9f13e0...
- sha256:1b2c3d...

ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰:
alpine (5MB) + nginx (20MB) = 25MB
alpine (5MB) + redis (15MB) = 20MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì¤‘ë³µ ì œê±° ì—†ì´: 50MB
Content Store:  40MB (alpine 1ë²ˆë§Œ)
```

#### Metadata Database

```
Metadata DB: ì´ë¯¸ì§€/ì»¨í…Œì´ë„ˆ ì •ë³´ ê´€ë¦¬

/var/lib/containerd/io.containerd.metadata.v1.bolt/meta.db
(BoltDB: Key-Value ì €ì¥ì†Œ)

ì €ì¥ ë‚´ìš©:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë°ì´í„° ì¢…ë¥˜       â”‚ ë‚´ìš©                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Images         â”‚ - ì´ë¯¸ì§€ ì´ë¦„ â†’ Manifest digest         â”‚
â”‚                â”‚ - alpine:latest â†’ sha256:abc123...   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Containers     â”‚ - ì»¨í…Œì´ë„ˆ ID â†’ ë©”íƒ€ë°ì´í„°                â”‚
â”‚                â”‚ - rootfs snapshot ID                 â”‚
â”‚                â”‚ - runtime ì •ë³´                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content        â”‚ - Digest â†’ Blob ì •ë³´                  â”‚
â”‚                â”‚ - í¬ê¸°, ìƒì„± ì‹œê°„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Snapshots      â”‚ - Snapshot ID â†’ Parent               â”‚
â”‚                â”‚ - ê³„ì¸µ êµ¬ì¡°                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì¡°íšŒ íë¦„:
ctr image pull alpine:latest
    â”‚
    â–¼
1. Registryì— alpine:latest ìš”ì²­
    â”‚
    â–¼
2. Manifest ë‹¤ìš´ë¡œë“œ (sha256:abc123...)
    â”‚
    â–¼
3. Metadata DBì— "alpine:latest" â†’ sha256:abc123 ì €ì¥
    â”‚
    â–¼
4. Manifestì˜ ë ˆì´ì–´ digest íŒŒì‹±
    â”‚
    â–¼
5. Content Storeì— ê° ë ˆì´ì–´ ë‹¤ìš´ë¡œë“œ
    â”‚
    â–¼
6. ì™„ë£Œ
```

---

### 3. Snapshot ê´€ë¦¬

#### Snapshotì˜ ì—­í• 

```
Snapshot: ì»¨í…Œì´ë„ˆì˜ íŒŒì¼ì‹œìŠ¤í…œ ì¤€ë¹„

Snapshotì€ ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•©ì¹¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Image Layers (Content Store, Read-Only)                â”‚
â”‚                                                        â”‚
â”‚  Layer 3: /app/myapp                                   â”‚
â”‚  Layer 2: /usr/bin/curl                                â”‚
â”‚  Layer 1: /bin/sh, /etc, /lib (alpine base)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snapshot (ì»¨í…Œì´ë„ˆ ì „ìš©, Read-Write)                      â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Writable Layer (Container changes)              â”‚   â”‚
â”‚  â”‚ - /tmp/cache-file                               â”‚   â”‚
â”‚  â”‚ - /var/log/app.log                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚ (Union Mount)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 3 (Read-Only)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 2 (Read-Only)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Layer 1 (Read-Only)                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚  ì»¨í…Œì´ë„ˆëŠ” ì´ í†µí•©ëœ ë·°ë¥¼ rootfsë¡œ ë´„                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Snapshot ê³„ì¸µ êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Snapshot 3  â”‚ â† Container (Read-Write)
â”‚  (Active)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Parent
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Snapshot 2  â”‚ â† Layer 3 (Committed)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Parent
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Snapshot 1  â”‚ â† Layer 2 (Committed)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Parent
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Snapshot 0  â”‚ â† Layer 1 (Committed)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Snapshotter ì¢…ë¥˜

```
containerdê°€ ì§€ì›í•˜ëŠ” Snapshotter:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snapshotter â”‚ ë°©ì‹           â”‚ ì„±ëŠ¥          â”‚ ì§€ì› FS      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ overlayfs   â”‚ Union Mount   â”‚ â˜…â˜…â˜…â˜…â˜†        â”‚ ext4, xfs   â”‚
â”‚ (ê¸°ë³¸)       â”‚               â”‚              â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ btrfs       â”‚ CoW Subvolume â”‚ â˜…â˜…â˜…â˜…â˜…        â”‚ Btrfs       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ zfs         â”‚ Clone         â”‚ â˜…â˜…â˜…â˜…â˜…        â”‚ ZFS         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ native      â”‚ Copy          â”‚ â˜…â˜†â˜†â˜†â˜†        â”‚ All         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OverlayFS ë™ì‘ ì›ë¦¬:
/var/lib/containerd/.../snapshots/
â”œâ”€â”€ 1/
â”‚   â””â”€â”€ fs/  â† Layer 1 (base)
â”œâ”€â”€ 2/
â”‚   â”œâ”€â”€ fs/  â† Layer 2 (changes from 1)
â”‚   â””â”€â”€ work/
â”œâ”€â”€ 3/
â”‚   â”œâ”€â”€ fs/  â† Container (writable)
â”‚   â””â”€â”€ work/

Mount ì‹œ:
mount -t overlay overlay
  -o lowerdir=1/fs:2/fs  â† Read-Only layers
  -o upperdir=3/fs       â† Read-Write layer
  -o workdir=3/work      â† OverlayFS ì‘ì—… ê³µê°„
  /var/lib/containerd/.../rootfs

ì»¨í…Œì´ë„ˆê°€ /app/file ìˆ˜ì • ì‹œ:
1. lowerdir (1/fs, 2/fs)ì—ì„œ íŒŒì¼ ì°¾ê¸°
2. upperdir (3/fs)ë¡œ ë³µì‚¬ (Copy-on-Write)
3. ë³µì‚¬ë³¸ ìˆ˜ì •
4. ì›ë³¸ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
```

---

### 4. Task ê´€ë¦¬

#### Task vs Container

```
Container vs Task:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Container (ë©”íƒ€ë°ì´í„°)                                    â”‚
â”‚                                                        â”‚
â”‚  - ì»¨í…Œì´ë„ˆ ID, ì´ë¦„                                      â”‚
â”‚  - ì´ë¯¸ì§€ ì°¸ì¡°                                           â”‚
â”‚  - rootfs snapshot ID                                  â”‚
â”‚  - ëŸ°íƒ€ì„ ì„¤ì • (spec)                                    â”‚
â”‚  - Created ìƒíƒœì—ì„œë„ ì¡´ì¬                                â”‚
â”‚                                                       â”‚
â”‚  "ì»¨í…Œì´ë„ˆì˜ ì •ì˜ì™€ ì„¤ì •"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Task (ì‹¤ì œ í”„ë¡œì„¸ìŠ¤)                                      â”‚
â”‚                                                        â”‚
â”‚  - Process PID                                         â”‚
â”‚  - í”„ë¡œì„¸ìŠ¤ ìƒíƒœ (Running, Paused, Stopped)               â”‚
â”‚  - I/O ìŠ¤íŠ¸ë¦¼ (stdin, stdout, stderr)                    â”‚
â”‚  - Exit code                                           â”‚
â”‚  - Running ìƒíƒœì¼ ë•Œë§Œ ì¡´ì¬                                â”‚
â”‚                                                        â”‚
â”‚  "ì»¨í…Œì´ë„ˆì˜ ì‹¤ì œ ì‹¤í–‰"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¹„ìœ :
Container = ìë™ì°¨ ì„¤ê³„ë„
Task      = ì‹¤ì œë¡œ ë‹¬ë¦¬ëŠ” ìë™ì°¨

ëª…ë ¹ì–´ íë¦„:
ctr container create alpine:latest mycontainer
  â†’ Container ìƒì„± (spec, rootfs ì¤€ë¹„)
  â†’ ContainerëŠ” "Created" ìƒíƒœ

ctr task start mycontainer
  â†’ Task ì‹œì‘ (runc run í˜¸ì¶œ)
  â†’ í”„ë¡œì„¸ìŠ¤ ìƒì„±, PID í• ë‹¹
  â†’ ContainerëŠ” "Running" ìƒíƒœ

ctr task kill mycontainer
  â†’ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
  â†’ Task ì‚­ì œ
  â†’ ContainerëŠ” "Stopped" ìƒíƒœ (ë©”íƒ€ë°ì´í„°ëŠ” ë‚¨ìŒ)

ctr container delete mycontainer
  â†’ Container ë©”íƒ€ë°ì´í„° ì‚­ì œ
  â†’ rootfs snapshot ì‚­ì œ
```

---

## ğŸ”§ ì‹¤ìŠµ 1: containerdì™€ ctr ê¸°ë³¸ ì‚¬ìš©

### Step 1: containerd ìƒíƒœ í™•ì¸

```bash
# containerd ë²„ì „ ë° ìƒíƒœ í™•ì¸
sudo systemctl status containerd

# ctr ë²„ì „ í™•ì¸
ctr version

# ì¶œë ¥:
# Client:
#   Version:  1.7.13
# Server:
#   Version:  1.7.13

# containerd ì„¤ì • íŒŒì¼ í™•ì¸
cat /etc/containerd/config.toml | grep -A 5 "\[plugins\]"

# Default namespace í™•ì¸
ctr namespace ls

# ì¶œë ¥:
# NAME   LABELS
# default
# moby        â† Dockerê°€ ì‚¬ìš©í•˜ëŠ” namespace
# k8s.io      â† Kubernetesê°€ ì‚¬ìš©í•˜ëŠ” namespace (ìˆë‹¤ë©´)
```

### Step 2: ì´ë¯¸ì§€ Pull (Docker ì—†ì´)

```bash
# ctrë¡œ ì§ì ‘ ì´ë¯¸ì§€ pull
ctr image pull docker.io/library/alpine:latest

# ì§„í–‰ ìƒí™© ì¶œë ¥:
# docker.io/library/alpine:latest:                                    resolved
# index-sha256:1234...
# manifest-sha256:5678...
# config-sha256:abcd...
# layer-sha256:1111...: downloading    |+++++| 3.4 MiB/3.4 MiB
# elapsed: 2.5 s    total:  3.4 MiB (1.4 MiB/s)

# ë‹¤ìš´ë¡œë“œëœ ì´ë¯¸ì§€ í™•ì¸
ctr image ls

# ì¶œë ¥:
# REF                            TYPE       SIZE      PLATFORMS
# docker.io/library/alpine:latest oci        7.3 MiB   linux/amd64

# ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´
ctr image ls -q | head -1 | xargs ctr image info

# Manifestì™€ Config ì •ë³´ ì¶œë ¥
```

### Step 3: Content Store íƒìƒ‰

```bash
# Content Store ìœ„ì¹˜
sudo ls -lh /var/lib/containerd/io.containerd.content.v1.content/blobs/sha256/

# ì¶œë ¥: ë‹¤ìš´ë¡œë“œëœ blob íŒŒì¼ë“¤ (ê° ë ˆì´ì–´)
# -rw-r--r-- 1 root root 3.4M ... a3ed95caeb02ff...
# -rw-r--r-- 1 root root 1.5K ... e3b0c44298fc1c...

# íŠ¹ì • blob ë‚´ìš© í™•ì¸ (gzip ì••ì¶•ëœ tar)
BLOB=$(sudo ls /var/lib/containerd/io.containerd.content.v1.content/blobs/sha256/ | head -1)
sudo zcat /var/lib/containerd/io.containerd.content.v1.content/blobs/sha256/$BLOB | tar -tv | head -10

# ì¶œë ¥: ë ˆì´ì–´ì— í¬í•¨ëœ íŒŒì¼ ëª©ë¡
# drwxr-xr-x 0/0               0 2024-01-01 00:00 bin/
# lrwxrwxrwx 0/0               0 2024-01-01 00:00 bin/arch -> /bin/busybox
# ...

# Content Store í†µê³„
ctr content ls | wc -l  # Blob ê°œìˆ˜
```

---

## ğŸ”§ ì‹¤ìŠµ 2: ì»¨í…Œì´ë„ˆ ìƒì„± ë° ì‹¤í–‰

### Step 1: Container ìƒì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)

```bash
# 1. ì»¨í…Œì´ë„ˆ ìƒì„± (Created ìƒíƒœ)
ctr container create \
  docker.io/library/alpine:latest \
  mycontainer \
  /bin/sh -c "echo Hello; sleep 30"

# 2. ìƒì„±ëœ ì»¨í…Œì´ë„ˆ í™•ì¸
ctr container ls

# ì¶œë ¥:
# CONTAINER     IMAGE                              RUNTIME
# mycontainer   docker.io/library/alpine:latest    io.containerd.runc.v2

# 3. ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸
ctr container info mycontainer | jq '.Spec.process.args'
# ì¶œë ¥: ["/bin/sh", "-c", "echo Hello; sleep 30"]

# 4. ì´ ì‹œì ì—ì„œ í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
ps aux | grep mycontainer  # ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì˜´
```

### Step 2: Task ì‹œì‘ (í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰)

```bash
# 1. Task ì‹œì‘
ctr task start -d mycontainer

# ì¶œë ¥:
# PID: 12345  â† ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ì˜ PID

# 2. Task í™•ì¸
ctr task ls

# ì¶œë ¥:
# TASK          PID    STATUS
# mycontainer   12345  RUNNING

# 3. í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep 12345

# ì¶œë ¥:
# root  12345  ... /bin/sh -c echo Hello; sleep 30

# 4. Task ë¡œê·¸ í™•ì¸
ctr task exec --exec-id test mycontainer cat /proc/1/cmdline
# ì¶œë ¥: /bin/sh-cecho Hello; sleep 30

# 5. Taskê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
ctr task wait mycontainer
```

### Step 3: ì¸í„°ë™í‹°ë¸Œ ì»¨í…Œì´ë„ˆ

```bash
# TTY í¬í•¨ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
ctr run -t --rm docker.io/library/alpine:latest shell-test /bin/sh

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‰˜ ì‹¤í–‰ë¨
# / # uname -a
# / # cat /etc/os-release
# / # exit

# --rm: ì¢…ë£Œ ì‹œ ìë™ ì‚­ì œ
```

### Step 4: ì •ë¦¬

```bash
# 1. Task ì¢…ë£Œ (ì´ë¯¸ ì¢…ë£Œë˜ì—ˆì„ ìˆ˜ë„ ìˆìŒ)
ctr task kill mycontainer || true

# 2. Task ì‚­ì œ
ctr task delete mycontainer || true

# 3. Container ì‚­ì œ
ctr container delete mycontainer

# 4. í™•ì¸
ctr container ls  # ë¹„ì–´ ìˆì–´ì•¼ í•¨
```

---

## ğŸ”§ ì‹¤ìŠµ 3: Namespace í™œìš©

### Step 1: Dockerì™€ì˜ Namespace ê²©ë¦¬

```bash
# 1. Dockerë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œ)
docker run -d --name docker-nginx nginx:alpine

# 2. ctr ê¸°ë³¸ namespaceì—ì„œ í™•ì¸ (ì•ˆ ë³´ì„)
ctr container ls

# ì¶œë ¥: (ë¹„ì–´ ìˆìŒ)

# 3. moby namespaceì—ì„œ í™•ì¸ (Dockerê°€ ì‚¬ìš©)
ctr -n moby container ls

# ì¶œë ¥:
# CONTAINER    IMAGE                        RUNTIME
# docker-nginx ...nginx:alpine              io.containerd.runc.v2

# 4. moby namespaceì˜ ì´ë¯¸ì§€ë„ í™•ì¸
ctr -n moby image ls | grep nginx

# 5. Docker ì»¨í…Œì´ë„ˆ ì •ì§€ ë° ì‚­ì œ
docker stop docker-nginx
docker rm docker-nginx
```

### Step 2: ì»¤ìŠ¤í…€ Namespace ì‚¬ìš©

```bash
# 1. ìƒˆ namespace ìƒì„± (ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ìë™ ìƒì„±ë¨)
ctr -n production image pull docker.io/library/redis:alpine

# 2. production namespaceì— ì»¨í…Œì´ë„ˆ ìƒì„±
ctr -n production run -d docker.io/library/redis:alpine prod-redis

# 3. Namespace ëª©ë¡ í™•ì¸
ctr namespace ls

# ì¶œë ¥:
# NAME        LABELS
# default
# moby
# production  â† ìƒˆë¡œ ìƒì„±ë¨

# 4. ê° namespaceì˜ ì»¨í…Œì´ë„ˆ í™•ì¸
ctr -n default container ls     # ë¹„ì–´ ìˆìŒ
ctr -n production container ls  # prod-redis ìˆìŒ

# 5. ì •ë¦¬
ctr -n production task kill prod-redis
ctr -n production task delete prod-redis
ctr -n production container delete prod-redis
```

### Step 3: Namespace Labels í™œìš©

```bash
# Namespaceì— label ì¶”ê°€ (metadata)
ctr namespace create dev --label team=backend

# Namespace ì •ë³´ í™•ì¸
ctr namespace ls

# Labelë¡œ í•„í„°ë§ (ì§ì ‘ ì§€ì›í•˜ì§€ ì•Šìœ¼ë‚˜ metadataë¡œ ì‚¬ìš© ê°€ëŠ¥)
ctr namespace ls | grep dev
```

---

## ğŸ”§ ì‹¤ìŠµ 4: Snapshot ê´€ë¦¬

### Step 1: Snapshot ëª©ë¡ í™•ì¸

```bash
# 1. ì´ë¯¸ì§€ pull (ë ˆì´ì–´ë³„ snapshot ìƒì„±ë¨)
ctr image pull docker.io/library/nginx:alpine

# 2. Snapshot ëª©ë¡ í™•ì¸
ctr snapshot ls

# ì¶œë ¥:
# KEY                                                      PARENT                        KIND
# sha256-1234...                                                                        Committed
# sha256-5678...                                           sha256-1234...                Committed
# sha256-abcd...                                           sha256-5678...                Committed

# KIND:
# - Committed: ì´ë¯¸ì§€ ë ˆì´ì–´ (Read-Only)
# - Active: ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš© ì¤‘ (Read-Write)

# 3. Snapshot ê³„ì¸µ êµ¬ì¡° í™•ì¸
ctr snapshot tree
```

### Step 2: ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ Snapshot ë³€í™”

```bash
# 1. ì‹¤í–‰ ì „ snapshot ê°œìˆ˜
BEFORE=$(ctr snapshot ls | wc -l)

# 2. ì»¨í…Œì´ë„ˆ ìƒì„± ë° ì‹¤í–‰
ctr run -d docker.io/library/nginx:alpine web-server nginx -g "daemon off;"

# 3. ì‹¤í–‰ í›„ snapshot ê°œìˆ˜ (Active snapshot ì¶”ê°€ë¨)
AFTER=$(ctr snapshot ls | wc -l)
echo "Snapshot ì¦ê°€: $((AFTER - BEFORE))"

# 4. Active snapshot í™•ì¸
ctr snapshot ls | grep Active

# ì¶œë ¥:
# extract-123456-abc                                      sha256-abcd...    Active

# 5. Snapshot ì‚¬ìš©ëŸ‰ í™•ì¸
ctr snapshot usage extract-123456-abc

# 6. ì •ë¦¬
ctr task kill web-server
ctr task delete web-server
ctr container delete web-server

# Active snapshot ìë™ ì‚­ì œë¨
```

### Step 3: Snapshot ì§ì ‘ ìƒì„±

```bash
# 1. ì´ë¯¸ì§€ ë ˆì´ì–´ ê¸°ë°˜ìœ¼ë¡œ snapshot ìƒì„±
IMAGE="docker.io/library/alpine:latest"
ctr image pull $IMAGE

# 2. rootfs snapshot ì¤€ë¹„
ctr snapshot prepare my-snapshot $IMAGE

# 3. ìƒì„±ëœ snapshot í™•ì¸
ctr snapshot ls | grep my-snapshot

# ì¶œë ¥:
# my-snapshot                                      sha256-xxx...    Active

# 4. Snapshot ë‚´ìš© í™•ì¸ (íŒŒì¼ì‹œìŠ¤í…œ)
sudo ls /var/lib/containerd/io.containerd.snapshotter.v1.overlayfs/snapshots/

# 5. Snapshotì„ Committedë¡œ ë³€í™˜
ctr snapshot commit my-snapshot-committed my-snapshot

# 6. ì •ë¦¬
ctr snapshot remove my-snapshot-committed
```

---

## ğŸ”§ ì‹¤ìŠµ 5: ê³ ê¸‰ ê¸°ëŠ¥ - Content ë° Task ê´€ë¦¬

### Step 1: Content ê²€ì¦

```bash
# 1. ì´ë¯¸ì§€ pull
ctr image pull docker.io/library/busybox:latest

# 2. ì´ë¯¸ì§€ì˜ content ì •ë³´ í™•ì¸
ctr content ls | grep -A 3 busybox

# 3. íŠ¹ì • contentì˜ ì •ë³´ í™•ì¸ (digest ì‚¬ìš©)
DIGEST=$(ctr image ls -q | grep busybox | head -1)
ctr content info $DIGEST

# ì¶œë ¥:
# Digest: sha256:1234...
# Size:   1.2MB
# CreatedAt: 2024-01-15T10:00:00Z

# 4. Content ë¬´ê²°ì„± ê²€ì¦
ctr content fetch $DIGEST > /tmp/blob.tar.gz
sha256sum /tmp/blob.tar.gz  # Digestì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
rm /tmp/blob.tar.gz
```

### Step 2: Task ê³ ê¸‰ ì œì–´

```bash
# 1. ë°±ê·¸ë¼ìš´ë“œ Task ì‹¤í–‰
ctr run -d docker.io/library/alpine:latest long-task sleep 300

# 2. Task PID í™•ì¸
PID=$(ctr task ls | grep long-task | awk '{print $2}')
echo "Container PID: $PID"

# 3. Task ì¼ì‹œ ì •ì§€ (Pause)
ctr task pause long-task

# Task ìƒíƒœ í™•ì¸
ctr task ls
# ì¶œë ¥: PAUSED

# 4. Task ì¬ê°œ (Resume)
ctr task resume long-task

# 5. Taskì—ì„œ ì¶”ê°€ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (exec)
ctr task exec --exec-id debug-1 long-task /bin/sh -c "ps aux"

# ì¶œë ¥: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ í”„ë¡œì„¸ìŠ¤ ëª©ë¡
# PID   USER     COMMAND
# 1     root     sleep 300

# 6. Task metrics (ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰)
ctr task metrics long-task

# 7. ì •ë¦¬
ctr task kill long-task
ctr task delete long-task
ctr container delete long-task
```

### Step 3: ì—¬ëŸ¬ Task ë™ì‹œ ê´€ë¦¬

```bash
# 1. ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ ìƒì„±
for i in {1..3}; do
  ctr run -d docker.io/library/alpine:latest "task-$i" sleep 600
done

# 2. ëª¨ë“  Task ëª©ë¡
ctr task ls

# 3. íŠ¹ì • Taskë§Œ ì„ íƒ (ì´ë¦„ íŒ¨í„´)
ctr task ls | grep task-

# 4. ëª¨ë“  Taskì— ëª…ë ¹ ì‹¤í–‰ (ìŠ¤í¬ë¦½íŠ¸)
for task in $(ctr task ls -q | grep task-); do
  echo "=== $task ==="
  ctr task exec --exec-id check-$task $task hostname
done

# 5. ì¼ê´„ ì •ë¦¬
for task in $(ctr task ls -q | grep task-); do
  ctr task kill $task
  ctr task delete $task
  ctr container delete $task
done
```

---

## ğŸ’¡ ì£¼ìš” ëª…ë ¹ì–´ ì •ë¦¬

```bash
# ========== Namespace ==========
ctr namespace ls                        # Namespace ëª©ë¡
ctr namespace create <ns>               # Namespace ìƒì„±
ctr namespace remove <ns>               # Namespace ì‚­ì œ
ctr -n <ns> [command]                   # íŠ¹ì • namespaceì—ì„œ ëª…ë ¹ ì‹¤í–‰

# ========== Images ==========
ctr image pull <image>                  # ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
ctr image ls                            # ì´ë¯¸ì§€ ëª©ë¡
ctr image rm <image>                    # ì´ë¯¸ì§€ ì‚­ì œ
ctr image info <image>                  # ì´ë¯¸ì§€ ìƒì„¸ ì •ë³´
ctr image export <file> <image>         # ì´ë¯¸ì§€ export
ctr image import <file>                 # ì´ë¯¸ì§€ import

# ========== Containers ==========
ctr container create <image> <id>       # ì»¨í…Œì´ë„ˆ ìƒì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)
ctr container ls                        # ì»¨í…Œì´ë„ˆ ëª©ë¡
ctr container info <id>                 # ì»¨í…Œì´ë„ˆ ì •ë³´
ctr container delete <id>               # ì»¨í…Œì´ë„ˆ ì‚­ì œ

# ========== Tasks ==========
ctr task start [-d] <id>                # Task ì‹œì‘ (-d: detach)
ctr task ls                             # Task ëª©ë¡
ctr task kill <id>                      # Task ì¢…ë£Œ (SIGKILL)
ctr task delete <id>                    # Task ì‚­ì œ
ctr task pause <id>                     # Task ì¼ì‹œ ì •ì§€
ctr task resume <id>                    # Task ì¬ê°œ
ctr task exec <id> <cmd>                # Taskì—ì„œ ëª…ë ¹ ì‹¤í–‰
ctr task metrics <id>                   # Task ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

# ========== Run (create + start) ==========
ctr run [ì˜µì…˜] <image> <id> <cmd>       # ì»¨í…Œì´ë„ˆ ì¦‰ì‹œ ì‹¤í–‰
  -d                                    # Detach (ë°±ê·¸ë¼ìš´ë“œ)
  -t                                    # TTY í• ë‹¹
  --rm                                  # ì¢…ë£Œ ì‹œ ìë™ ì‚­ì œ
  --mount type=bind,src=<>,dst=<>       # ë³¼ë¥¨ ë§ˆìš´íŠ¸

# ========== Content Store ==========
ctr content ls                          # Content ëª©ë¡
ctr content info <digest>               # Content ì •ë³´
ctr content fetch <digest>              # Content ê°€ì ¸ì˜¤ê¸°

# ========== Snapshots ==========
ctr snapshot ls                         # Snapshot ëª©ë¡
ctr snapshot prepare <key> <parent>     # Snapshot ì¤€ë¹„
ctr snapshot commit <key> <name>        # Active â†’ Committed
ctr snapshot remove <key>               # Snapshot ì‚­ì œ
ctr snapshot tree                       # Snapshot ê³„ì¸µ êµ¬ì¡°

# ========== ë²„ì „ ë° ì •ë³´ ==========
ctr version                             # ctr ë²„ì „
containerd --version                    # containerd ë²„ì „
ctr plugins ls                          # ë¡œë“œëœ í”ŒëŸ¬ê·¸ì¸ ëª©ë¡
```

---

## ğŸ“ ì—°ìŠµ ë¬¸ì œ

### ë¬¸ì œ 1: Dockerì˜ ì»¨í…Œì´ë„ˆë¥¼ ctrë¡œ í™•ì¸í•˜ë ¤ë©´ ì–´ë–¤ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

Dockerê°€ ì‚¬ìš©í•˜ëŠ” namespaceëŠ” **"moby"** ì…ë‹ˆë‹¤. ë”°ë¼ì„œ:

```bash
# Docker ì»¨í…Œì´ë„ˆ í™•ì¸
ctr -n moby container ls

# Docker ì´ë¯¸ì§€ í™•ì¸
ctr -n moby image ls

# Docker Task í™•ì¸
ctr -n moby task ls
```

**ì´ìœ :**
Docker (dockerd)ëŠ” containerdë¥¼ ì‚¬ìš©í•  ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ "moby" namespaceë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” Dockerê°€ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì™€ ë‹¤ë¥¸ ë„êµ¬(ì˜ˆ: Kubernetes, ctr ì§ì ‘ ì‚¬ìš©)ê°€ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ê²©ë¦¬í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

```bash
# í™•ì¸ ë°©ë²•
docker run -d --name test nginx
ctr -n moby container ls | grep test  # âœ… ë³´ì„
ctr container ls | grep test          # âŒ ì•ˆ ë³´ì„ (default namespace)
docker rm -f test
```

</details>

### ë¬¸ì œ 2: Content Storeê°€ ì¤‘ë³µ ì œê±°(Deduplication)ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ê°€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

Content StoreëŠ” **Content-Addressable Storage** ë°©ì‹ìœ¼ë¡œ ì¤‘ë³µì„ ì œê±°í•©ë‹ˆë‹¤:

**ì›ë¦¬:**
1. **SHA256 í•´ì‹±**: ê° íŒŒì¼(ë ˆì´ì–´)ì˜ ë‚´ìš©ìœ¼ë¡œ SHA256 í•´ì‹œë¥¼ ê³„ì‚°
2. **í•´ì‹œ ê¸°ë°˜ ì €ì¥**: í•´ì‹œë¥¼ íŒŒì¼ëª…ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ì €ì¥
3. **ìë™ ì¤‘ë³µ ì œê±°**: ê°™ì€ ë‚´ìš© = ê°™ì€ í•´ì‹œ = 1ë²ˆë§Œ ì €ì¥

**ì˜ˆì‹œ:**
```
Image A: alpine:3.18 (base) + nginx
- Layer 1: sha256:a3ed95... (alpine base)
- Layer 2: sha256:9f13e0... (nginx)

Image B: alpine:3.18 (base) + redis
- Layer 1: sha256:a3ed95... (alpine base)  â† Aì™€ ë™ì¼!
- Layer 2: sha256:1b2c3d... (redis)

Content Store ì €ì¥:
/var/lib/containerd/.../blobs/sha256/
â”œâ”€â”€ a3ed95...  â† 1ë²ˆë§Œ ì €ì¥ (A, B ê³µìœ )
â”œâ”€â”€ 9f13e0...  â† nginx
â””â”€â”€ 1b2c3d...  â† redis

ë””ìŠ¤í¬ ì ˆì•½:
alpine (5MB) + nginx (20MB) = 25MB
alpine (5MB) + redis (15MB) = 20MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì¤‘ë³µ ì œê±° ì—†ì´: 50MB (alpine 2ë²ˆ)
Content Store:  40MB (alpine 1ë²ˆ)
```

**ì¶”ê°€ ì¥ì :**
- **ë¬´ê²°ì„± ê²€ì¦**: í•´ì‹œë¡œ ì†ìƒ ì—¬ë¶€ í™•ì¸
- **ë³‘ë ¬ ë‹¤ìš´ë¡œë“œ**: ë ˆì´ì–´ë³„ ë…ë¦½ì  ë‹¤ìš´ë¡œë“œ
- **ë ˆì´ì–´ ê³µìœ **: ì—¬ëŸ¬ ì´ë¯¸ì§€ê°€ base ë ˆì´ì–´ ê³µìœ 

</details>

### ë¬¸ì œ 3: Containerì™€ Taskì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì´ë©°, ì™œ ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ê°€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

**Container**ì™€ **Task**ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì—­í• ì„ í•©ë‹ˆë‹¤:

| êµ¬ë¶„ | Container | Task |
|------|-----------|------|
| **ì˜ë¯¸** | ì»¨í…Œì´ë„ˆì˜ ì •ì˜ì™€ ì„¤ì • | ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ |
| **ë‚´ìš©** | ì´ë¯¸ì§€, rootfs, spec, ë©”íƒ€ë°ì´í„° | PID, ìƒíƒœ, I/O ìŠ¤íŠ¸ë¦¼ |
| **ìƒëª…ì£¼ê¸°** | `create` ~ `delete` | `start` ~ `kill/exit` |
| **ìƒíƒœ** | Created, Stopped ë“± | Running, Paused ë“± |
| **ì¡´ì¬ ì‹œê¸°** | ì»¨í…Œì´ë„ˆ ì‚­ì œ ì „ê¹Œì§€ | í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ì¤‘ë§Œ |

**ëª…ë ¹ì–´ íë¦„:**
```bash
# 1. Container ìƒì„± (ë©”íƒ€ë°ì´í„°ë§Œ)
ctr container create alpine:latest mycontainer /bin/sh
  â†’ Container: Created ìƒíƒœ
  â†’ Task: ì—†ìŒ (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)

# 2. Task ì‹œì‘ (í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰)
ctr task start mycontainer
  â†’ Container: Running ìƒíƒœ
  â†’ Task: Running (PID í• ë‹¹ë¨)

# 3. Task ì¢…ë£Œ
ctr task kill mycontainer
  â†’ Container: Stopped ìƒíƒœ (ë©”íƒ€ë°ì´í„°ëŠ” ë‚¨ìŒ)
  â†’ Task: ì‚­ì œë¨

# 4. Container ì‚­ì œ
ctr container delete mycontainer
  â†’ Container: ì™„ì „ ì‚­ì œ
```

**ì™œ ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ê°€?**

1. **ìƒëª…ì£¼ê¸° ë…ë¦½ì„±**: ì»¨í…Œì´ë„ˆ ì •ì˜ëŠ” ìœ ì§€í•˜ë©´ì„œ í”„ë¡œì„¸ìŠ¤ë§Œ ì¬ì‹œì‘ ê°€ëŠ¥
2. **Hooks ì‹¤í–‰**: `create`ì™€ `start` ì‚¬ì´ì— prestart hook ì‹¤í–‰
3. **ë„¤íŠ¸ì›Œí¬ ì„¤ì •**: containerdê°€ create í›„ ë„¤íŠ¸ì›Œí¬ë¥¼ ì„¤ì •í•˜ê³  start
4. **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: Kubernetesê°€ ëª¨ë“  Pod ì»¨í…Œì´ë„ˆë¥¼ create í›„ ìˆœì„œëŒ€ë¡œ start
5. **ë””ë²„ê¹…**: ì»¨í…Œì´ë„ˆ í™˜ê²½ êµ¬ì„± í›„ ë¬¸ì œ í™•ì¸ ê°€ëŠ¥

**ë¹„ìœ :**
- **Container** = ìë™ì°¨ ì„¤ê³„ë„ (ìŠ¤í™, ë¶€í’ˆ)
- **Task** = ì‹¤ì œë¡œ ë‹¬ë¦¬ëŠ” ìë™ì°¨ (ì—”ì§„ ê°€ë™, ìš´ì „ ì¤‘)

</details>

---

## ğŸ“Œ í•µì‹¬ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°œë…              â”‚ ì„¤ëª…                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ containerd       â”‚ Mid-level ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„                 â”‚
â”‚                  â”‚ dockerdì™€ runc ì‚¬ì´                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ctr              â”‚ containerd CLI (ë””ë²„ê¹…/ê´€ë¦¬ìš©)           â”‚
â”‚                  â”‚ Docker ì—†ì´ ì»¨í…Œì´ë„ˆ ì œì–´                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Namespace        â”‚ ë©€í‹°í…Œë„Œì‹œ ê²©ë¦¬                           â”‚
â”‚                  â”‚ moby(Docker), k8s.io, default         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Content Store    â”‚ Content-Addressable Storage           â”‚
â”‚                  â”‚ SHA256 ê¸°ë°˜ ì¤‘ë³µ ì œê±°                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Snapshot         â”‚ ì»¨í…Œì´ë„ˆ íŒŒì¼ì‹œìŠ¤í…œ ì¤€ë¹„                    â”‚
â”‚                  â”‚ Overlayfs, Btrfs, ZFS                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Metadata DB      â”‚ BoltDBë¡œ ë©”íƒ€ë°ì´í„° ê´€ë¦¬                  â”‚
â”‚                  â”‚ ì´ë¯¸ì§€/ì»¨í…Œì´ë„ˆ ì •ë³´ ì €ì¥                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Container        â”‚ ì»¨í…Œì´ë„ˆ ì •ì˜ (ë©”íƒ€ë°ì´í„°)                  â”‚
â”‚                  â”‚ ì´ë¯¸ì§€, rootfs, spec                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Task             â”‚ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤                        â”‚
â”‚                  â”‚ PID, ìƒíƒœ, I/O ìŠ¤íŠ¸ë¦¼                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kubernetes CRI   â”‚ kubelet â†’ containerd ì§ì ‘ í˜¸ì¶œ          â”‚
â”‚                  â”‚ Docker ìš°íšŒ (v1.24+)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

containerd ë°ì´í„° ìœ„ì¹˜:
/var/lib/containerd/
â”œâ”€â”€ io.containerd.content.v1.content/     â† Blobs (ë ˆì´ì–´)
â”œâ”€â”€ io.containerd.metadata.v1.bolt/       â† Metadata DB
â”œâ”€â”€ io.containerd.snapshotter.v1.*/       â† Snapshots
â””â”€â”€ io.containerd.runtime.v2.task/        â† Tasks
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [containerd Official Documentation](https://containerd.io/docs/)
- [containerd GitHub](https://github.com/containerd/containerd)
- [ctr Command Reference](https://github.com/containerd/containerd/blob/main/docs/ops.md)
- [Kubernetes CRI](https://kubernetes.io/docs/concepts/architecture/cri/)
- [OCI Image Spec](https://github.com/opencontainers/image-spec)
- [containerd Architecture](https://github.com/containerd/containerd/blob/main/docs/ARCHITECTURE.md)

---

## ğŸ¤” ìƒê°í•´ë³¼ ë¬¸ì œ

1. Dockerê°€ containerdë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ”? dockerdê°€ ì§ì ‘ runcë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ”?
2. Kubernetesê°€ v1.24ë¶€í„° dockershimì„ ì œê±°í•˜ê³  containerdë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ”?
3. Content Storeì˜ Content-Addressable ë°©ì‹ì´ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì™€ ì–´ë–»ê²Œ ì—°ê³„ë˜ëŠ”ê°€?

> ğŸ’¡ **ë‹µë³€**: 
> 
> **1) Dockerê°€ containerdë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ :**
> - **ëª¨ë“ˆí™”**: dockerdëŠ” ë„¤íŠ¸ì›Œí¬, ë³¼ë¥¨ ë“± High-level ê¸°ëŠ¥ì— ì§‘ì¤‘, containerdëŠ” ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì— ì§‘ì¤‘
> - **ì•ˆì •ì„±**: dockerd ì¬ì‹œì‘ ì‹œì—ë„ containerdê°€ ì»¨í…Œì´ë„ˆë¥¼ ìœ ì§€ (Live Restore)
> - **í‘œì¤€í™”**: OCI í‘œì¤€ ì¤€ìˆ˜, ëŸ°íƒ€ì„ êµì²´ ê°€ëŠ¥ (runc â†” crun â†” kata)
> - **ì¬ì‚¬ìš©**: Kubernetes ë“± ë‹¤ë¥¸ ë„êµ¬ë“¤ë„ containerdë¥¼ ê³µìœ  ì‚¬ìš©
> - **ë³´ì•ˆ**: ê¶Œí•œ ë¶„ë¦¬ (dockerdëŠ” root í•„ìš”, containerdëŠ” ìµœì†Œ ê¶Œí•œ)
> 
> **2) Kubernetesê°€ containerdë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì´ìœ :**
> - **ì¤‘ë³µ ì œê±°**: Dockerì˜ ë„¤íŠ¸ì›Œí¬/ìŠ¤í† ë¦¬ì§€ ê¸°ëŠ¥ì„ Kubernetesê°€ ì´ë¯¸ êµ¬í˜„ (ì¤‘ë³µ)
> - **í˜¸ì¶œ ê²½ë¡œ ë‹¨ì¶•**: kubelet â†’ dockershim â†’ dockerd â†’ containerd â†’ runc ì—ì„œ kubelet â†’ containerd â†’ runcë¡œ ë‹¨ì¶•
> - **ë¦¬ì†ŒìŠ¤ ì ˆì•½**: dockerd í”„ë¡œì„¸ìŠ¤ ë¶ˆí•„ìš”, ë©”ëª¨ë¦¬/CPU ì ˆì•½
> - **ìœ ì§€ë³´ìˆ˜ ë‹¨ìˆœí™”**: Docker ë²„ì „ ì˜ì¡´ì„± ì œê±°
> - **CRI í‘œì¤€**: CRI (Container Runtime Interface)ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ëŸ°íƒ€ì„ ì§€ì›
> 
> **3) Content Storeì™€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì˜ ì—°ê³„:**
> ```
> Registry (ì›ê²©)                      Local (containerd)
> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
> GET /v2/alpine/manifests/latest
>   â†’ Manifest ë°˜í™˜
>     {
>       "layers": [
>         {"digest": "sha256:a3ed95..."}
>       ]
>     }
> 
> GET /v2/alpine/blobs/sha256:a3ed95...
>   â†’ Layer blob ë°˜í™˜                â†’ Content Storeì— ì €ì¥
>                                      /blobs/sha256/a3ed95...
> 
> ì´ë¯¸ ìˆìœ¼ë©´ ë‹¤ìš´ë¡œë“œ ìŠ¤í‚µ!
> Content Storeì— sha256:a3ed95... ì¡´ì¬?
>   â†’ Yes: Skip (ì¤‘ë³µ ì œê±°)
>   â†’ No: Download
> ```
> - Registryë„ SHA256 ê¸°ë°˜ìœ¼ë¡œ blob ì €ì¥
> - Digestê°€ ì¼ì¹˜í•˜ë©´ ê°™ì€ ë ˆì´ì–´ â†’ ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ìµœì†Œí™”
> - Multi-registry í™˜ê²½ì—ì„œë„ ë ˆì´ì–´ ê³µìœ  ê°€ëŠ¥
> - ë¬´ê²°ì„± ìë™ ê²€ì¦ (digest ë¶ˆì¼ì¹˜ ì‹œ ì—ëŸ¬)

---

<div align="center">

**[â¬…ï¸ ì´ì „: OCI Specification](./02-OCI-Specification.md)** | **[ë‹¤ìŒ: runc â¡ï¸](./04-runc.md)**

</div>
