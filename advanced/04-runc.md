# 04. runc - Low-level ì»¨í…Œì´ë„ˆ ì‹¤í–‰

## ğŸ¯ ì´ ì±•í„°ì—ì„œ ë°°ìš¸ ê²ƒ

- **runc ì§ì ‘ ì‚¬ìš©**: Docker/containerd ì—†ì´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
- **OCI Bundle ìƒì„±**: config.jsonê³¼ rootfs ì¤€ë¹„
- **spec íŒŒì¼ ì‘ì„±**: ë¦¬ì†ŒìŠ¤, Namespace, Cgroup ì„¤ì •
- **Container Lifecycle**: create, start, kill, delete ì œì–´
- **rootless ì»¨í…Œì´ë„ˆ**: ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
- **ê³ ê¸‰ ì„¤ì •**: Seccomp, Capabilities, Hooks í™œìš©

## ğŸ“Œ ì™œ ì¤‘ìš”í•œê°€?

**"runcë¥¼ ì§ì ‘ ë‹¤ë£¨ë©´ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì˜ ëª¨ë“  ë ˆì´ì–´ë¥¼ ì™„ì „íˆ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."**

```
ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì˜ ìµœì¢… ë‹¨ê³„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Command                                            â”‚
â”‚ docker run nginx                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ High-level Runtime (dockerd)                            â”‚
â”‚ - ì´ë¯¸ì§€ ê´€ë¦¬, ë„¤íŠ¸ì›Œí¬, ë³¼ë¥¨                                 â”‚
â”‚ - ì‚¬ìš©ì í¸ì˜ ê¸°ëŠ¥                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ gRPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mid-level Runtime (containerd)                          â”‚
â”‚ - OCI ì´ë¯¸ì§€ â†’ OCI Bundle ë³€í™˜                             â”‚
â”‚ - Snapshot ê´€ë¦¬, Content Store                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ OCI Bundle (config.json + rootfs)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Low-level Runtime (runc)         â† ì´ ì±•í„°ì˜ í•µì‹¬!         â”‚
â”‚                                                         â”‚
â”‚ OCI Runtime Spec êµ¬í˜„ì²´                                  â”‚
â”‚ - config.json íŒŒì‹±                                       â”‚
â”‚ - Linux Namespace ìƒì„± (PID, NET, MNT, UTS, IPC)         â”‚
â”‚ - Cgroup ì„¤ì • (CPU, Memory, I/O)                         â”‚
â”‚ - rootfs ë§ˆìš´íŠ¸                                          â”‚
â”‚ - clone() + execve() ì‹œìŠ¤í…œ ì½œ                            â”‚
â”‚                                                         â”‚
â”‚ "ì‹¤ì œë¡œ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ìœ ì¼í•œ ê³„ì¸µ"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Container Process (PID 1)                               â”‚
â”‚ - ê²©ë¦¬ëœ Namespace ë‚´ë¶€                                    â”‚
â”‚ - Cgroup ì œí•œ ì ìš©ë¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

runcì˜ ì—­í• :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì…ë ¥            â”‚ OCI Bundle (config.json + rootfs/)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë™ì‘            â”‚ 1. Namespace ìƒì„±                     â”‚
â”‚                â”‚ 2. Cgroup ì„¤ì •                        â”‚
â”‚                â”‚ 3. rootfs ë§ˆìš´íŠ¸                       â”‚
â”‚                â”‚ 4. Capabilities ì„¤ì •                  â”‚
â”‚                â”‚ 5. Seccomp í•„í„° ì ìš©                   â”‚
â”‚                â”‚ 6. clone() ì‹œìŠ¤í…œ ì½œ                   â”‚
â”‚                â”‚ 7. execve() í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì¶œë ¥            â”‚ ê²©ë¦¬ëœ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

runcë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì´ìœ :
âŒ Docker:     ì¶”ìƒí™” + í¸ì˜ ê¸°ëŠ¥ (ë¬´ê±°ì›€)
âŒ containerd: ì´ë¯¸ì§€ ê´€ë¦¬ + ëŸ°íƒ€ì„ (ì¤‘ê°„)
âœ… runc:       ìˆœìˆ˜ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (ê°€ë²¼ì›€)

ì–¸ì œ ì§ì ‘ ì‚¬ìš©í•˜ëŠ”ê°€:
- ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ê°œë°œ
- ìµœì†Œí•œì˜ ì˜¤ë²„í—¤ë“œ í•„ìš”
- ë””ë²„ê¹… ë° í•™ìŠµ
- ì„ë² ë””ë“œ ì‹œìŠ¤í…œ
```

**ì‹¤ë¬´ ì˜í–¥:**
- **ëŸ°íƒ€ì„ ë””ë²„ê¹…**: Docker/Kubernetes ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸ íŒŒì•…
- **ê²½ëŸ‰ í™˜ê²½**: ìµœì†Œ ì˜ì¡´ì„±ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
- **ë³´ì•ˆ ì—°êµ¬**: Namespace, Seccomp ë“± ê²©ë¦¬ ë©”ì»¤ë‹ˆì¦˜ ì´í•´
- **ëŸ°íƒ€ì„ ê°œë°œ**: ì»¤ìŠ¤í…€ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ê°œë°œ ê¸°ì´ˆ

---

## ğŸ”¬ Deep Dive

### 1. runc ê°œìš”

#### runcë€?

```
runc: OCI Runtime Specificationì˜ ì°¸ì¡° êµ¬í˜„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         runc                            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OCI Runtime Spec 1.0+ ì™„ì „ êµ¬í˜„                     â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ - Runtime Configuration (config.json)             â”‚  â”‚
â”‚  â”‚ - Container Lifecycle (create/start/kill/delete)  â”‚  â”‚
â”‚  â”‚ - Linux Features (namespace, cgroup, seccomp)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  íŠ¹ì§•:                                                   â”‚
â”‚  âœ… Goë¡œ ì‘ì„± (libcontainer ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)                 â”‚
â”‚  âœ… Dockerì—ì„œ ì¶”ì¶œí•˜ì—¬ ë…ë¦½ í”„ë¡œì íŠ¸ë¡œ ë¶„ë¦¬                    â”‚
â”‚  âœ… ëª¨ë“  ì£¼ìš” ì»¨í…Œì´ë„ˆ ë„êµ¬ì˜ ê¸°ë³¸ ëŸ°íƒ€ì„                       â”‚
â”‚  âœ… rootless ëª¨ë“œ ì§€ì› (ë¹„íŠ¹ê¶Œ ì‚¬ìš©ì)                       â”‚
â”‚  âœ… systemd cgroup ë“œë¼ì´ë²„ ì§€ì›                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

runcì˜ ìœ„ì¹˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OCI Ecosystem                           â”‚
â”‚                                         â”‚
â”‚  Runtime Spec â†â”€â”€â”€ runc (ì°¸ì¡° êµ¬í˜„)       â”‚
â”‚      â†“                                  â”‚
â”‚  Image Spec   â†â”€â”€â”€ (buildah, skopeo)    â”‚
â”‚      â†“                                  â”‚
â”‚  Distribution â†â”€â”€â”€ (registry)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì—­ì‚¬:
2015: Dockerì—ì„œ libcontainer ê°œë°œ
2015: OCI ì„¤ë¦½, runc ë…ë¦½ í”„ë¡œì íŠ¸ë¡œ ë¶„ë¦¬
2016: OCI Runtime Spec 1.0 ë¦´ë¦¬ìŠ¤
í˜„ì¬: ëª¨ë“  ì£¼ìš” ëŸ°íƒ€ì„ì˜ ê¸°ë°˜ (Docker, containerd, Podman)
```

#### runc vs ë‹¤ë¥¸ ëŸ°íƒ€ì„

```
Low-level Runtime ë¹„êµ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëŸ°íƒ€ì„    â”‚ ì–¸ì–´   â”‚ ë©”ëª¨ë¦¬  â”‚ ì†ë„      â”‚ íŠ¹ì§•        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc     â”‚ Go   â”‚ ~10MB  â”‚ ê¸°ì¤€     â”‚ OCI í‘œì¤€    â”‚
â”‚ (ì°¸ì¡°)    â”‚      â”‚        â”‚ 100%    â”‚ êµ¬í˜„        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ crun     â”‚ C    â”‚ ~3MB   â”‚ ~2ë°° ë¹ ë¦„ â”‚ ê²½ëŸ‰í™”      â”‚
â”‚          â”‚      â”‚        â”‚         â”‚ (Podman)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ youki    â”‚ Rust â”‚ ~5MB   â”‚ ~1.5ë°°   â”‚ ë©”ëª¨ë¦¬ ì•ˆì „  â”‚
â”‚          â”‚      â”‚        â”‚         â”‚ (ì‹¤í—˜ì )    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ kata     â”‚ Go+  â”‚ ~50MB  â”‚ ëŠë¦¼     â”‚ VM ê²©ë¦¬     â”‚
â”‚          â”‚ QEMU â”‚        â”‚         â”‚ (ë³´ì•ˆ)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì„±ëŠ¥ ë¹„êµ (ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œê°„):
runc:  ~50ms
crun:  ~25ms
youki: ~35ms
kata:  ~500ms (VM ë¶€íŒ…)

runcë¥¼ ì„ íƒí•˜ëŠ” ì´ìœ :
âœ… ì•ˆì •ì„±: ê°€ì¥ ì˜¤ë˜ë˜ê³  ê²€ì¦ë¨
âœ… í˜¸í™˜ì„±: ëª¨ë“  ë„êµ¬ê°€ ì§€ì›
âœ… ê¸°ëŠ¥: ìµœì‹  OCI Spec ì¦‰ì‹œ ì§€ì›
âœ… ì»¤ë®¤ë‹ˆí‹°: í™œë°œí•œ ê°œë°œ
```

---

### 2. OCI Bundle ì´í•´

#### Bundle êµ¬ì¡° ìƒì„¸

```
OCI Bundleì˜ ìµœì†Œ êµ¬ì„±:

my-container/                    â† Bundle root
â”œâ”€â”€ config.json                  â† ëŸ°íƒ€ì„ ì„¤ì • (í•„ìˆ˜)
â””â”€â”€ rootfs/                      â† ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ (í•„ìˆ˜)
    â”œâ”€â”€ bin/
    â”œâ”€â”€ dev/                     â† (ë§ˆìš´íŠ¸ í¬ì¸íŠ¸)
    â”œâ”€â”€ etc/
    â”œâ”€â”€ home/
    â”œâ”€â”€ lib/
    â”œâ”€â”€ proc/                    â† (ë§ˆìš´íŠ¸ í¬ì¸íŠ¸)
    â”œâ”€â”€ root/
    â”œâ”€â”€ sys/                     â† (ë§ˆìš´íŠ¸ í¬ì¸íŠ¸)
    â”œâ”€â”€ tmp/
    â”œâ”€â”€ usr/
    â””â”€â”€ var/

config.json ì£¼ìš” í•„ë“œ:
{
  "ociVersion": "1.0.0",         â† OCI Spec ë²„ì „
  
  "process": {                   â† ì‹¤í–‰í•  í”„ë¡œì„¸ìŠ¤
    "terminal": true,
    "user": {"uid": 0, "gid": 0},
    "args": ["/bin/sh"],
    "env": ["PATH=/usr/local/sbin:..."],
    "cwd": "/"
  },
  
  "root": {                      â† rootfs ìœ„ì¹˜
    "path": "rootfs",
    "readonly": false
  },
  
  "hostname": "mycontainer",     â† ì»¨í…Œì´ë„ˆ í˜¸ìŠ¤íŠ¸ëª…
  
  "mounts": [                    â† ë§ˆìš´íŠ¸ í¬ì¸íŠ¸
    {
      "destination": "/proc",
      "type": "proc",
      "source": "proc"
    },
    {
      "destination": "/dev",
      "type": "tmpfs",
      "source": "tmpfs"
    },
    ...
  ],
  
  "linux": {                     â† Linux ì „ìš© ì„¤ì •
    "namespaces": [              â† Namespace ëª©ë¡
      {"type": "pid"},
      {"type": "network"},
      {"type": "mount"},
      {"type": "uts"},
      {"type": "ipc"}
    ],
    
    "resources": {               â† Cgroup ë¦¬ì†ŒìŠ¤
      "memory": {
        "limit": 536870912       â† 512MB
      },
      "cpu": {
        "quota": 50000,          â† 0.5 CPU
        "period": 100000
      }
    },
    
    "seccomp": {                 â† Seccomp í”„ë¡œíŒŒì¼
      "defaultAction": "SCMP_ACT_ALLOW",
      "syscalls": [...]
    }
  }
}

Bundle ìƒì„± ê³¼ì •:
1. ë””ë ‰í† ë¦¬ ìƒì„±: mkdir my-container
2. rootfs ì¤€ë¹„: ì´ë¯¸ì§€ì—ì„œ ì¶”ì¶œ ë˜ëŠ” ì§ì ‘ êµ¬ì„±
3. config.json ìƒì„±: runc spec (í…œí”Œë¦¿) ìˆ˜ì •
4. runc run ì‹¤í–‰
```

#### rootfs ì¤€ë¹„ ë°©ë²•

```
rootfsë¥¼ ì¤€ë¹„í•˜ëŠ” 4ê°€ì§€ ë°©ë²•:

1. Docker ì´ë¯¸ì§€ì—ì„œ ì¶”ì¶œ:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ docker export $(docker create alpine) â”‚
   â”‚   | tar -C rootfs -xf -               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   ì¥ì : ê¸°ì¡´ ì´ë¯¸ì§€ í™œìš©
   ë‹¨ì : Docker í•„ìš”

2. containerdì—ì„œ ì¶”ì¶œ:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ctr image export alpine.tar alpine  â”‚
   â”‚ mkdir rootfs                        â”‚
   â”‚ tar -C rootfs -xf alpine.tar        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   ì¥ì : OCI í‘œì¤€ ì´ë¯¸ì§€
   ë‹¨ì : containerd í•„ìš”

3. debootstrap (Debian/Ubuntu):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ debootstrap --arch=amd64 jammy      â”‚
   â”‚   rootfs http://archive.ubuntu.com  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   ì¥ì : ê¹¨ë—í•œ OS í™˜ê²½
   ë‹¨ì : ì‹œê°„ ì˜¤ë˜ ê±¸ë¦¼

4. ìµœì†Œ rootfs ì§ì ‘ êµ¬ì„±:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ mkdir -p rootfs/{bin,lib,etc}       â”‚
   â”‚ cp /bin/busybox rootfs/bin/         â”‚
   â”‚ cp -a /lib/x86_64-linux-gnu rootfs/ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   ì¥ì : ì™„ì „í•œ ì œì–´
   ë‹¨ì : ë³µì¡í•¨

ì¼ë°˜ì ìœ¼ë¡œ 1ë²ˆ ë°©ë²• ì‚¬ìš© (ê°€ì¥ ê°„ë‹¨)
```

---

### 3. Container Lifecycle

#### runc ëª…ë ¹ì–´ íë¦„

```
runcì˜ Container Lifecycle:

ë°©ë²• 1: run (í•œ ë²ˆì— ì‹¤í–‰)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ runc run â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Running
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                              â”‚ exit
                              â–¼
                           Stopped

ë°©ë²• 2: create + start (ë‹¨ê³„ë³„)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ runc create â”‚ â”€â”€â”€â”€â”€â†’ Created
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                          â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ runc start      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                       Running
                          â”‚
                          â”‚ runc kill / exit
                          â–¼
                       Stopped
                          â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ runc delete     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ëª…ë ¹ì–´ ì„¤ëª…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëª…ë ¹ì–´         â”‚ ë™ì‘                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc run     â”‚ create + start í•œ ë²ˆì—               â”‚
â”‚              â”‚ (foreground ì‹¤í–‰)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc create  â”‚ í™˜ê²½ êµ¬ì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)              â”‚
â”‚              â”‚ - Namespace ìƒì„±                    â”‚
â”‚              â”‚ - Cgroup ì„¤ì •                       â”‚
â”‚              â”‚ - rootfs ë§ˆìš´íŠ¸                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc start   â”‚ Created â†’ Running                  â”‚
â”‚              â”‚ - í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (execve)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc kill    â”‚ ì‹œê·¸ë„ ì „ì†¡                           â”‚
â”‚              â”‚ - SIGTERM (ê¸°ë³¸)                    â”‚
â”‚              â”‚ - SIGKILL (ê°•ì œ)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc delete  â”‚ ì»¨í…Œì´ë„ˆ ì •ë¦¬                         â”‚
â”‚              â”‚ - Cgroup ì‚­ì œ                       â”‚
â”‚              â”‚ - Namespace ì •ë¦¬                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc state   â”‚ í˜„ì¬ ìƒíƒœ í™•ì¸                        â”‚
â”‚              â”‚ - PID, Status, Bundle              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc list    â”‚ ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc exec    â”‚ ì‹¤í–‰ ì¤‘ ì»¨í…Œì´ë„ˆì— ëª…ë ¹ ì‹¤í–‰              â”‚
â”‚              â”‚ - ìƒˆ í”„ë¡œì„¸ìŠ¤ ì¶”ê°€                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

create/start ë¶„ë¦¬ì˜ ì´ìœ :
1. Hooks ì‹¤í–‰: prestart hookì´ create~start ì‚¬ì´ ì‹¤í–‰
2. ë„¤íŠ¸ì›Œí¬ ì„¤ì •: containerdê°€ create í›„ ë„¤íŠ¸ì›Œí¬ ì—°ê²°
3. ê²€ì¦: í™˜ê²½ êµ¬ì„± í›„ ë¬¸ì œ í™•ì¸
4. ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜: ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ ìˆœì°¨ ì‹œì‘
```

#### Hooks ì‹œìŠ¤í…œ

```
OCI Hooks: ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

Hooks íƒ€ì´ë°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚  runc create                                        â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ Namespace, Cgroup ìƒì„±                       â”‚
â”‚      â”œâ”€ rootfs ë§ˆìš´íŠ¸                                â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ [prestart hook] â—„â”€â”€â”€ ì´ ì‹œì ì— ì‹¤í–‰            â”‚
â”‚      â”‚   (ì˜ˆ: ë„¤íŠ¸ì›Œí¬ ì„¤ì •)                            â”‚
â”‚      â”‚                                              â”‚
â”‚      â””â”€ Created ìƒíƒœ                                 â”‚
â”‚                                                     â”‚
â”‚  runc start                                         â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ [createRuntime hook] â—„â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ìƒì„± ì§ì „    â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (execve)                         â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ [createContainer hook] â—„â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ìƒì„± ì§í›„  â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ [startContainer hook] â—„â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ í›„     â”‚
â”‚      â”‚                                              â”‚
â”‚      â””â”€ Running ìƒíƒœ                                 â”‚
â”‚                                                     â”‚
â”‚  (ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘...)                                  â”‚
â”‚                                                     â”‚
â”‚  runc kill / exit                                   â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ                                  â”‚
â”‚      â”‚                                              â”‚
â”‚      â”œâ”€ [poststop hook] â—„â”€â”€â”€ ì¢…ë£Œ í›„ ì •ë¦¬              â”‚
â”‚      â”‚   (ì˜ˆ: ë¡œê·¸ ìˆ˜ì§‘)                               â”‚
â”‚      â”‚                                              â”‚
â”‚      â””â”€ Stopped ìƒíƒœ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

config.jsonì— hooks ì •ì˜:
{
  "hooks": {
    "prestart": [
      {
        "path": "/usr/local/bin/setup-network.sh",
        "args": ["setup-network.sh", "arg1"],
        "env": ["FOO=bar"]
      }
    ],
    "poststop": [
      {
        "path": "/usr/local/bin/cleanup.sh"
      }
    ]
  }
}

Hook ì‚¬ìš© ì˜ˆ:
- prestart: CNI í”ŒëŸ¬ê·¸ì¸ ì‹¤í–‰ (ë„¤íŠ¸ì›Œí¬ ì„¤ì •)
- poststop: ë¡œê·¸ ìˆ˜ì§‘, ë©”íŠ¸ë¦­ ì „ì†¡
- createRuntime: ë³´ì•ˆ ì •ì±… ì ìš©
```

---

### 4. Namespace ë° Cgroup ì„¤ì •

#### Namespace ì„¤ì •

```
config.jsonì˜ Namespace ì„¤ì •:

{
  "linux": {
    "namespaces": [
      {"type": "pid"},      â† PID Namespace
      {"type": "network"},  â† Network Namespace
      {"type": "mount"},    â† Mount Namespace
      {"type": "uts"},      â† UTS Namespace (hostname)
      {"type": "ipc"},      â† IPC Namespace
      {"type": "cgroup"}    â† Cgroup Namespace (ì„ íƒ)
    ]
  }
}

Namespaceë³„ íš¨ê³¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type     â”‚ ê²©ë¦¬ ëŒ€ìƒ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pid      â”‚ í”„ë¡œì„¸ìŠ¤ ID                            â”‚
â”‚          â”‚ - ì»¨í…Œì´ë„ˆ ë‚´ë¶€ëŠ” PID 1ë¶€í„° ì‹œì‘           â”‚
â”‚          â”‚ - í˜¸ìŠ¤íŠ¸ PID ì•ˆ ë³´ì„                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ network  â”‚ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤, ë¼ìš°íŒ… í…Œì´ë¸”           â”‚
â”‚          â”‚ - ë…ë¦½ëœ eth0, lo                     â”‚
â”‚          â”‚ - iptables ê·œì¹™ ê²©ë¦¬                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mount    â”‚ íŒŒì¼ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸                        â”‚
â”‚          â”‚ - ë…ë¦½ëœ / (rootfs)                   â”‚
â”‚          â”‚ - í˜¸ìŠ¤íŠ¸ ë§ˆìš´íŠ¸ ì•ˆ ë³´ì„                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uts      â”‚ í˜¸ìŠ¤íŠ¸ëª…, ë„ë©”ì¸ëª…                       â”‚
â”‚          â”‚ - hostname ë…ë¦½                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ipc      â”‚ IPC ë¦¬ì†ŒìŠ¤ (ì„¸ë§ˆí¬ì–´, ê³µìœ  ë©”ëª¨ë¦¬)          â”‚
â”‚          â”‚ - í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  ê²©ë¦¬                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ cgroup   â”‚ Cgroup ê³„ì¸µ                           â”‚
â”‚          â”‚ - /sys/fs/cgroup ë·° ê²©ë¦¬              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê¸°ì¡´ Namespace ì¬ì‚¬ìš©:
{
  "namespaces": [
    {"type": "pid"},
    {
      "type": "network",
      "path": "/var/run/netns/mynet"  â† ê¸°ì¡´ network ns ì‚¬ìš©
    },
    {"type": "mount"}
  ]
}

Namespace ê³µìœ  (ì˜ˆ: í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬):
{
  "namespaces": [
    {"type": "pid"},
    {"type": "mount"},
    {"type": "uts"},
    {"type": "ipc"}
    // network ì—†ìŒ â†’ í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©
  ]
}
```

#### Cgroup ë¦¬ì†ŒìŠ¤ ì œí•œ

```
config.jsonì˜ Cgroup ì„¤ì •:

{
  "linux": {
    "resources": {
      "memory": {
        "limit": 536870912,           â† 512MB
        "reservation": 268435456,     â† Soft limit (256MB)
        "swap": 1073741824            â† Swap í¬í•¨ 1GB
      },
      
      "cpu": {
        "shares": 1024,               â† CPU ê³µìœ  ê°€ì¤‘ì¹˜
        "quota": 50000,               â† 100ms ì¤‘ 50ms (0.5 CPU)
        "period": 100000,             â† 100ms ì£¼ê¸°
        "cpus": "0-3"                 â† CPU 0,1,2,3 ì‚¬ìš©
      },
      
      "blockIO": {
        "weight": 500,                â† I/O ê°€ì¤‘ì¹˜ (100-1000)
        "throttleReadBpsDevice": [
          {
            "major": 8,
            "minor": 0,
            "rate": 10485760          â† 10MB/s ì½ê¸° ì œí•œ
          }
        ]
      },
      
      "pids": {
        "limit": 100                  â† ìµœëŒ€ í”„ë¡œì„¸ìŠ¤ ìˆ˜
      },
      
      "network": {
        "classID": 1048577,           â† ë„¤íŠ¸ì›Œí¬ í´ë˜ìŠ¤
        "priorities": [
          {
            "name": "eth0",
            "priority": 500
          }
        ]
      }
    },
    
    "cgroupsPath": "/mygroup/container1"  â† Cgroup ê²½ë¡œ
  }
}

Cgroup ìœ„ì¹˜ (systemd ë“œë¼ì´ë²„):
/sys/fs/cgroup/
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ mygroup/
â”‚       â””â”€â”€ container1/
â”‚           â”œâ”€â”€ memory.limit_in_bytes  â† 512MB
â”‚           â””â”€â”€ memory.usage_in_bytes  â† í˜„ì¬ ì‚¬ìš©ëŸ‰
â”‚
â”œâ”€â”€ cpu/
â”‚   â””â”€â”€ mygroup/
â”‚       â””â”€â”€ container1/
â”‚           â”œâ”€â”€ cpu.cfs_quota_us      â† 50000
â”‚           â””â”€â”€ cpu.cfs_period_us     â† 100000
â”‚
â””â”€â”€ pids/
    â””â”€â”€ mygroup/
        â””â”€â”€ container1/
            â””â”€â”€ pids.max              â† 100

ë¦¬ì†ŒìŠ¤ ì œí•œ í™•ì¸:
cat /sys/fs/cgroup/memory/mygroup/container1/memory.limit_in_bytes
# 536870912
```

---

## ğŸ”§ ì‹¤ìŠµ 1: ê¸°ë³¸ OCI Bundle ìƒì„± ë° ì‹¤í–‰

### Step 1: Bundle ë””ë ‰í† ë¦¬ ì¤€ë¹„

```bash
# 1. ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p ~/runc-demo
cd ~/runc-demo

# 2. rootfs ì¤€ë¹„ (Docker ì´ë¯¸ì§€ì—ì„œ ì¶”ì¶œ)
docker pull alpine:latest
docker export $(docker create alpine:latest) | tar -C . -xf -
mkdir rootfs
mv bin dev etc home lib media mnt opt proc root run sbin srv sys tmp usr var rootfs/

# ë˜ëŠ” ê°„ë‹¨í•˜ê²Œ:
# mkdir rootfs
# docker export $(docker create alpine:latest) | tar -C rootfs -xf -

# 3. rootfs ë‚´ìš© í™•ì¸
ls -la rootfs/

# ì¶œë ¥:
# drwxr-xr-x ... bin
# drwxr-xr-x ... etc
# drwxr-xr-x ... lib
# ...

# 4. rootfs í¬ê¸° í™•ì¸
du -sh rootfs/
# 7.3M rootfs/
```

### Step 2: config.json ìƒì„±

```bash
# 1. ê¸°ë³¸ config.json ìƒì„±
runc spec

# 2. ìƒì„±ëœ íŒŒì¼ í™•ì¸
ls -lh config.json

# 3. ë‚´ìš© í™•ì¸
cat config.json | jq '.process.args'
# ì¶œë ¥: ["sh"]

# 4. ì£¼ìš” ì„¤ì • í™•ì¸
echo "=== Process ==="
jq '.process' config.json

echo "=== Root ==="
jq '.root' config.json

echo "=== Namespaces ==="
jq '.linux.namespaces' config.json

echo "=== Resources ==="
jq '.linux.resources' config.json
```

### Step 3: ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# 1. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (foreground)
sudo runc run mycontainer

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‰˜ì´ ì‹¤í–‰ë¨:
# / # hostname
# runc
# / # ps aux
# PID   USER     TIME  COMMAND
#    1 root      0:00 sh
#    7 root      0:00 ps aux
# / # cat /proc/1/cgroup
# (cgroup ì •ë³´)
# / # exit

# 2. ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (detached)
sudo runc run -d mycontainer

# 3. ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸
sudo runc list

# ì¶œë ¥:
# ID            PID       STATUS    BUNDLE      CREATED
# mycontainer   12345     running   /home/.../  2024-...

# 4. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
sudo runc state mycontainer

# ì¶œë ¥:
# {
#   "ociVersion": "1.0.2",
#   "id": "mycontainer",
#   "pid": 12345,
#   "status": "running",
#   "bundle": "/home/.../runc-demo",
#   "created": "2024-01-15T10:00:00Z"
# }

# 5. ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
sudo runc kill mycontainer

# 6. ì»¨í…Œì´ë„ˆ ì‚­ì œ
sudo runc delete mycontainer

# 7. í™•ì¸
sudo runc list
# (ë¹„ì–´ ìˆìŒ)
```

---

## ğŸ”§ ì‹¤ìŠµ 2: config.json ì»¤ìŠ¤í„°ë§ˆì´ì§•

### Step 1: ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •

```bash
cd ~/runc-demo

# config.json ìˆ˜ì • (ë©”ëª¨ë¦¬ 512MB, CPU 0.5 ì½”ì–´)
jq '.linux.resources.memory.limit = 536870912' config.json > tmp.json && mv tmp.json config.json
jq '.linux.resources.cpu.quota = 50000' config.json > tmp.json && mv tmp.json config.json
jq '.linux.resources.cpu.period = 100000' config.json > tmp.json && mv tmp.json config.json

# ë˜ëŠ” ì§ì ‘ í¸ì§‘:
# vi config.json
# "resources": {
#   "memory": {
#     "limit": 536870912
#   },
#   "cpu": {
#     "quota": 50000,
#     "period": 100000
#   }
# }

# ì„¤ì • í™•ì¸
jq '.linux.resources' config.json

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
sudo runc run -d resource-test

# Cgroup í™•ì¸ (ì‹¤ì œ ì ìš© ì—¬ë¶€)
PID=$(sudo runc state resource-test | jq -r '.pid')
cat /proc/$PID/cgroup

# Memory limit í™•ì¸
CGROUP=$(cat /proc/$PID/cgroup | grep memory | cut -d: -f3)
cat /sys/fs/cgroup/memory${CGROUP}/memory.limit_in_bytes
# 536870912 (512MB)

# CPU quota í™•ì¸
CGROUP=$(cat /proc/$PID/cgroup | grep cpu | cut -d: -f3)
cat /sys/fs/cgroup/cpu${CGROUP}/cpu.cfs_quota_us
# 50000

# ì •ë¦¬
sudo runc kill resource-test
sudo runc delete resource-test
```

### Step 2: í™˜ê²½ ë³€ìˆ˜ ë° ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •

```bash
# í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
jq '.process.env += ["MY_VAR=hello", "DEBUG=true"]' config.json > tmp.json && mv tmp.json config.json

# ì‘ì—… ë””ë ‰í† ë¦¬ ë³€ê²½
jq '.process.cwd = "/tmp"' config.json > tmp.json && mv tmp.json config.json

# ì‹¤í–‰ ëª…ë ¹ì–´ ë³€ê²½
jq '.process.args = ["/bin/sh", "-c", "echo $MY_VAR; pwd; sleep 30"]' config.json > tmp.json && mv tmp.json config.json

# ì„¤ì • í™•ì¸
jq '.process | {env, cwd, args}' config.json

# ì‹¤í–‰
sudo runc run -d env-test

# ë¡œê·¸ í™•ì¸ (stdout/stderr)
sudo runc events env-test

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™•ì¸
sudo runc exec env-test /bin/sh -c 'echo $MY_VAR'
# ì¶œë ¥: hello

sudo runc exec env-test pwd
# ì¶œë ¥: /tmp

# ì •ë¦¬
sudo runc kill env-test
sudo runc delete env-test
```

### Step 3: Namespace ì„¤ì • ì¡°ì •

```bash
# í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© (network namespace ì œê±°)
jq 'del(.linux.namespaces[] | select(.type == "network"))' config.json > tmp.json && mv tmp.json config.json

# í™•ì¸
jq '.linux.namespaces[].type' config.json
# ì¶œë ¥: "pid", "mount", "ipc", "uts", "cgroup" (network ì—†ìŒ)

# ì‹¤í–‰
sudo runc run -d net-test

# ë„¤íŠ¸ì›Œí¬ í™•ì¸ (í˜¸ìŠ¤íŠ¸ì™€ ë™ì¼)
sudo runc exec net-test ip addr show
# í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ê°€ ë³´ì„

sudo runc exec net-test ip route
# í˜¸ìŠ¤íŠ¸ ë¼ìš°íŒ… í…Œì´ë¸”

# ì •ë¦¬
sudo runc kill net-test
sudo runc delete net-test

# network namespace ë‹¤ì‹œ ì¶”ê°€
jq '.linux.namespaces += [{"type": "network"}]' config.json > tmp.json && mv tmp.json config.json
```

---

## ğŸ”§ ì‹¤ìŠµ 3: create/start ë¶„ë¦¬ ì‹¤í–‰

### Step 1: Container ìƒì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)

```bash
cd ~/runc-demo

# ì‹¤í–‰ ëª…ë ¹ ì„¤ì • (ê¸´ sleep)
jq '.process.args = ["/bin/sh", "-c", "echo Started; sleep 60"]' config.json > tmp.json && mv tmp.json config.json

# 1. Container ìƒì„± (Created ìƒíƒœ)
sudo runc create lifecycle-test

# 2. ìƒíƒœ í™•ì¸
sudo runc state lifecycle-test

# ì¶œë ¥:
# {
#   "id": "lifecycle-test",
#   "pid": 0,              â† PID ì—†ìŒ (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)
#   "status": "created",   â† Created ìƒíƒœ
#   ...
# }

# 3. ëª©ë¡ í™•ì¸
sudo runc list

# ì¶œë ¥:
# ID              PID    STATUS     BUNDLE
# lifecycle-test  0      created    /home/.../runc-demo

# 4. ì´ ì‹œì ì—ì„œ í”„ë¡œì„¸ìŠ¤ ì—†ìŒ
ps aux | grep lifecycle  # ì•„ë¬´ê²ƒë„ ì•ˆ ë‚˜ì˜´
```

### Step 2: Task ì‹œì‘

```bash
# 1. Task ì‹œì‘ (Created â†’ Running)
sudo runc start lifecycle-test

# 2. ì¦‰ì‹œ ìƒíƒœ í™•ì¸
sudo runc state lifecycle-test

# ì¶œë ¥:
# {
#   "id": "lifecycle-test",
#   "pid": 23456,          â† PID í• ë‹¹ë¨!
#   "status": "running",   â† Running ìƒíƒœ
#   ...
# }

# 3. í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep 23456
# root  23456  ... /bin/sh -c echo Started; sleep 60

# 4. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™•ì¸
sudo runc exec lifecycle-test ps aux

# ì¶œë ¥:
# PID   USER     COMMAND
# 1     root     /bin/sh -c echo Started; sleep 60
# 7     root     ps aux
```

### Step 3: Lifecycle ì œì–´

```bash
# 1. ì»¨í…Œì´ë„ˆ ì¼ì‹œ ì •ì§€
sudo runc pause lifecycle-test

# ìƒíƒœ í™•ì¸
sudo runc state lifecycle-test | jq '.status'
# "paused"

# í”„ë¡œì„¸ìŠ¤ ìƒíƒœ í™•ì¸
ps aux | grep 23456
# ... (í”„ë¡œì„¸ìŠ¤ëŠ” ìˆì§€ë§Œ ì‹¤í–‰ ì¤‘ì§€ë¨)

# 2. ì»¨í…Œì´ë„ˆ ì¬ê°œ
sudo runc resume lifecycle-test

# ìƒíƒœ í™•ì¸
sudo runc state lifecycle-test | jq '.status'
# "running"

# 3. ì¢…ë£Œ ëŒ€ê¸° (ë³„ë„ í„°ë¯¸ë„)
# 60ì´ˆ í›„ ìë™ ì¢…ë£Œë¨
sudo runc wait lifecycle-test
# (ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°)

# 4. ë˜ëŠ” ê°•ì œ ì¢…ë£Œ
sudo runc kill lifecycle-test SIGTERM

# 5. ìƒíƒœ í™•ì¸
sudo runc state lifecycle-test | jq '.status'
# "stopped"

# 6. ì •ë¦¬
sudo runc delete lifecycle-test
```

---

## ğŸ”§ ì‹¤ìŠµ 4: Hooks í™œìš©

### Step 1: Hook ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

```bash
cd ~/runc-demo

# 1. prestart hook ìŠ¤í¬ë¦½íŠ¸
cat > prestart-hook.sh << 'EOF'
#!/bin/bash
echo "[HOOK] Prestart: Container is being set up"
echo "[HOOK] Bundle: $1"
echo "[HOOK] Time: $(date)"
EOF

chmod +x prestart-hook.sh

# 2. poststop hook ìŠ¤í¬ë¦½íŠ¸
cat > poststop-hook.sh << 'EOF'
#!/bin/bash
echo "[HOOK] Poststop: Container stopped"
echo "[HOOK] Container ID: $1"
echo "[HOOK] Cleanup completed"
EOF

chmod +x poststop-hook.sh
```

### Step 2: config.jsonì— Hooks ì¶”ê°€

```bash
# Hooks ì„¤ì • ì¶”ê°€
jq --arg pwd "$PWD" '.hooks = {
  "prestart": [
    {
      "path": ($pwd + "/prestart-hook.sh"),
      "args": ["prestart-hook.sh", ($pwd)],
      "timeout": 10
    }
  ],
  "poststop": [
    {
      "path": ($pwd + "/poststop-hook.sh"),
      "args": ["poststop-hook.sh"],
      "timeout": 5
    }
  ]
}' config.json > tmp.json && mv tmp.json config.json

# ì„¤ì • í™•ì¸
jq '.hooks' config.json
```

### Step 3: Hooks ì‹¤í–‰ í™•ì¸

```bash
# 1. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (hooks ì‹¤í–‰ë¨)
sudo runc run -d hook-test 2>&1 | tee hook-output.log

# ì¶œë ¥ì—ì„œ prestart hook ë©”ì‹œì§€ í™•ì¸:
# [HOOK] Prestart: Container is being set up
# [HOOK] Bundle: /home/.../runc-demo
# [HOOK] Time: ...

# 2. ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
sudo runc kill hook-test

# 3. ì •ë¦¬ (poststop hook ì‹¤í–‰ë¨)
sudo runc delete hook-test 2>&1 | tee -a hook-output.log

# ì¶œë ¥ì—ì„œ poststop hook ë©”ì‹œì§€ í™•ì¸:
# [HOOK] Poststop: Container stopped
# [HOOK] Container ID: hook-test
# [HOOK] Cleanup completed

# 4. ì „ì²´ ë¡œê·¸ í™•ì¸
cat hook-output.log
```

---

## ğŸ”§ ì‹¤ìŠµ 5: rootless ì»¨í…Œì´ë„ˆ

### Step 1: rootless í™˜ê²½ ì¤€ë¹„

```bash
# 1. ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰ (sudo ì—†ì´)
# ë¨¼ì € runc rootless ì§€ì› í™•ì¸
runc --version | grep rootless
# ì¶œë ¥: ... rootless: enabled

# 2. User Namespace ë§¤í•‘ í™•ì¸
cat /etc/subuid | grep $USER
cat /etc/subgid | grep $USER

# ì¶œë ¥ ì˜ˆ:
# username:100000:65536  â† UID 100000ë¶€í„° 65536ê°œ ë§¤í•‘
# username:100000:65536  â† GID 100000ë¶€í„° 65536ê°œ ë§¤í•‘

# ì—†ìœ¼ë©´ ì¶”ê°€:
# sudo usermod --add-subuids 100000-165535 --add-subgids 100000-165535 $USER

# 3. ìƒˆ ë””ë ‰í† ë¦¬ì—ì„œ ì‘ì—…
mkdir -p ~/runc-rootless
cd ~/runc-rootless

# 4. rootfs ì¤€ë¹„ (Docker ì—†ì´, ê¸°ì¡´ ì´ë¯¸ì§€ ë³µì‚¬)
# ë˜ëŠ” ìµœì†Œ Alpine rootfs ë‹¤ìš´ë¡œë“œ
wget https://dl-cdn.alpinelinux.org/alpine/v3.19/releases/x86_64/alpine-minirootfs-3.19.0-x86_64.tar.gz
mkdir rootfs
tar -C rootfs -xzf alpine-minirootfs-3.19.0-x86_64.tar.gz

# 5. config ìƒì„±
runc spec --rootless

# rootless ì „ìš© ì„¤ì • í™•ì¸
jq '.linux.uidMappings' config.json
jq '.linux.gidMappings' config.json
```

### Step 2: rootless ì»¨í…Œì´ë„ˆ ì‹¤í–‰

```bash
# 1. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (sudo ì—†ì´!)
runc run -d rootless-test

# 2. ìƒíƒœ í™•ì¸
runc state rootless-test

# 3. PID í™•ì¸
PID=$(runc state rootless-test | jq -r '.pid')
echo "Container PID: $PID"

# 4. í”„ë¡œì„¸ìŠ¤ ì†Œìœ ì í™•ì¸ (ì¼ë°˜ ì‚¬ìš©ì!)
ps -o user,pid,comm -p $PID
# USER     PID   COMMAND
# username 34567 sh

# 5. User Namespace í™•ì¸
cat /proc/$PID/uid_map
# ì¶œë ¥:
#          0 100000 65536
# ì»¨í…Œì´ë„ˆ UID 0 = í˜¸ìŠ¤íŠ¸ UID 100000

# 6. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™•ì¸
runc exec rootless-test id
# ì¶œë ¥: uid=0(root) gid=0(root) groups=0(root)
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” rootì§€ë§Œ ì‹¤ì œë¡œëŠ” ì¼ë°˜ ì‚¬ìš©ì!

# 7. ì •ë¦¬
runc kill rootless-test
runc delete rootless-test
```

### Step 3: rootless ì œì•½ ì‚¬í•­ í™•ì¸

```bash
# rootless ì»¨í…Œì´ë„ˆì˜ ì œì•½:

# 1. ë„¤íŠ¸ì›Œí¬ ì œí•œ (privileged port ì‚¬ìš© ë¶ˆê°€)
jq '.process.args = ["/bin/sh", "-c", "nc -l -p 80"]' config.json > tmp.json && mv tmp.json config.json

runc run -d port-test
# ì—ëŸ¬: bind: permission denied (port 80ì€ root í•„ìš”)

runc delete port-test 2>/dev/null || true

# 2. í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì ‘ê·¼ ì œí•œ
# rootfs ì™¸ë¶€ íŒŒì¼ì— ì ‘ê·¼ ì‹œ ê¶Œí•œ ë¬¸ì œ ë°œìƒ

# 3. Cgroup ì œí•œ (cgroup v2 + systemd í•„ìš”)
# ì¼ë¶€ ë¦¬ì†ŒìŠ¤ ì œí•œì€ rootlessì—ì„œ ë¶ˆê°€ëŠ¥

echo "rootless ì»¨í…Œì´ë„ˆëŠ” ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ ê²©ë¦¬ ì¶”ê°€"
echo "ë‹¨, ì¼ë¶€ ê¸°ëŠ¥ ì œì•½ì´ ìˆìŒ"
```

---

## ğŸ’¡ ì£¼ìš” ëª…ë ¹ì–´ ì •ë¦¬

```bash
# ========== Bundle ì¤€ë¹„ ==========
runc spec                               # ê¸°ë³¸ config.json ìƒì„±
runc spec --rootless                    # rootless ì „ìš© config ìƒì„±

# rootfs ì¤€ë¹„ (Dockerì—ì„œ ì¶”ì¶œ)
docker export $(docker create <image>) | tar -C rootfs -xf -

# ========== Container Lifecycle ==========
runc run <id>                           # ì»¨í…Œì´ë„ˆ ì¦‰ì‹œ ì‹¤í–‰ (foreground)
runc run -d <id>                        # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (detached)
runc create <id>                        # ì»¨í…Œì´ë„ˆ ìƒì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)
runc start <id>                         # Created â†’ Running
runc kill <id> [signal]                 # ì‹œê·¸ë„ ì „ì†¡ (ê¸°ë³¸ SIGTERM)
runc delete <id>                        # ì»¨í…Œì´ë„ˆ ì‚­ì œ

# ========== ìƒíƒœ ë° ê´€ë¦¬ ==========
runc list                               # ëª¨ë“  ì»¨í…Œì´ë„ˆ ëª©ë¡
runc state <id>                         # ì»¨í…Œì´ë„ˆ ìƒíƒœ (JSON)
runc ps <id>                            # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í”„ë¡œì„¸ìŠ¤ ëª©ë¡
runc exec <id> <cmd>                    # ì‹¤í–‰ ì¤‘ ì»¨í…Œì´ë„ˆì— ëª…ë ¹ ì‹¤í–‰
runc pause <id>                         # ì»¨í…Œì´ë„ˆ ì¼ì‹œ ì •ì§€
runc resume <id>                        # ì»¨í…Œì´ë„ˆ ì¬ê°œ

# ========== ì´ë²¤íŠ¸ ë° ëª¨ë‹ˆí„°ë§ ==========
runc events <id>                        # ì»¨í…Œì´ë„ˆ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼
runc wait <id>                          # ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ëŒ€ê¸°

# ========== ê³ ê¸‰ ê¸°ëŠ¥ ==========
runc checkpoint <id>                    # ì»¨í…Œì´ë„ˆ ì²´í¬í¬ì¸íŠ¸ (CRIU)
runc restore <id>                       # ì²´í¬í¬ì¸íŠ¸ì—ì„œ ë³µì›
runc update <id> --memory <bytes>       # ë¦¬ì†ŒìŠ¤ ì œí•œ ì—…ë°ì´íŠ¸

# ========== ë””ë²„ê¹… ==========
runc --debug run <id>                   # ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰
runc --log /tmp/runc.log run <id>       # ë¡œê·¸ íŒŒì¼ ì§€ì •

# ========== config.json ìˆ˜ì • (jq ì‚¬ìš©) ==========
# ë©”ëª¨ë¦¬ ì œí•œ 512MB
jq '.linux.resources.memory.limit = 536870912' config.json > tmp.json && mv tmp.json config.json

# CPU ì œí•œ 0.5 ì½”ì–´
jq '.linux.resources.cpu.quota = 50000' config.json > tmp.json && mv tmp.json config.json

# í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
jq '.process.env += ["FOO=bar"]' config.json > tmp.json && mv tmp.json config.json

# ì‹¤í–‰ ëª…ë ¹ ë³€ê²½
jq '.process.args = ["/bin/sh", "-c", "echo hello"]' config.json > tmp.json && mv tmp.json config.json
```

---

## ğŸ“ ì—°ìŠµ ë¬¸ì œ

### ë¬¸ì œ 1: runc runê³¼ runc create + startì˜ ì°¨ì´ì ì€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

| ëª…ë ¹ì–´ | ë™ì‘ | ì‚¬ìš© ì‹œê¸° |
|--------|------|----------|
| `runc run` | create + start í•œ ë²ˆì— | ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸, ìˆ˜ë™ ì‹¤í–‰ |
| `runc create` â†’ `runc start` | ë‹¨ê³„ë³„ ì‹¤í–‰ | Hooks ì‹¤í–‰, ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |

**runc run (í•œ ë²ˆì—):**
```bash
sudo runc run mycontainer
```
- ì¦‰ì‹œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
- Hooks íƒ€ì´ë° ì œì–´ ë¶ˆê°€
- ê°„ë‹¨í•˜ê³  ì§ê´€ì 

**runc create + start (ë¶„ë¦¬):**
```bash
# 1. í™˜ê²½ êµ¬ì„± (í”„ë¡œì„¸ìŠ¤ ë¯¸ì‹¤í–‰)
sudo runc create mycontainer

# ì´ ì‹œì :
# - Namespace ìƒì„±ë¨
# - Cgroup ì„¤ì •ë¨
# - rootfs ë§ˆìš´íŠ¸ë¨
# - prestart hook ì‹¤í–‰ë¨
# - í”„ë¡œì„¸ìŠ¤ëŠ” ì•„ì§ ì‹œì‘ ì•ˆ ë¨

# 2. ì¶”ê°€ ì‘ì—… ê°€ëŠ¥ (ì˜ˆ: ë„¤íŠ¸ì›Œí¬ ì„¤ì •)
# containerdê°€ ì—¬ê¸°ì„œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì—°ê²°

# 3. í”„ë¡œì„¸ìŠ¤ ì‹œì‘
sudo runc start mycontainer
```

**ë¶„ë¦¬ì˜ ì¥ì :**
1. **Hooks ì‹¤í–‰**: prestart hookì´ createì™€ start ì‚¬ì´ì— ì‹¤í–‰
2. **ë„¤íŠ¸ì›Œí¬ ì„¤ì •**: containerdê°€ create í›„ veth pair ì—°ê²°
3. **ê²€ì¦**: í™˜ê²½ êµ¬ì„± í›„ ë¬¸ì œê°€ ìˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
4. **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: Kubernetesê°€ ëª¨ë“  Pod ì»¨í…Œì´ë„ˆë¥¼ create í›„ ìˆœì„œëŒ€ë¡œ start
5. **ë””ë²„ê¹…**: ê° ë‹¨ê³„ë³„ ìƒíƒœ í™•ì¸ ê°€ëŠ¥

containerdì™€ KubernetesëŠ” í•­ìƒ create + startë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

</details>

### ë¬¸ì œ 2: rootless ì»¨í…Œì´ë„ˆëŠ” ì–´ë–»ê²Œ root ê¶Œí•œ ì—†ì´ ê²©ë¦¬ë¥¼ êµ¬í˜„í•˜ëŠ”ê°€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

rootless ì»¨í…Œì´ë„ˆëŠ” **User Namespace**ë¥¼ í™œìš©í•˜ì—¬ ê²©ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ë¦¬:**
```
í˜¸ìŠ¤íŠ¸ (ì‹¤ì œ)          ì»¨í…Œì´ë„ˆ (ë³´ì´ëŠ” ê²ƒ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UID 100000            â†’  UID 0 (root)
UID 100001            â†’  UID 1
UID 100002            â†’  UID 2
...
UID 165535            â†’  UID 65535

ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” "root"ì§€ë§Œ
ì‹¤ì œë¡œëŠ” ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë¨
```

**ì„¤ì • ë°©ë²•:**

1. **/etc/subuid, /etc/subgid ì„¤ì •:**
```bash
# ì‚¬ìš©ìì—ê²Œ UID/GID ë²”ìœ„ í• ë‹¹
$ cat /etc/subuid
username:100000:65536

$ cat /etc/subgid
username:100000:65536
```

2. **config.jsonì˜ UID/GID ë§¤í•‘:**
```json
{
  "linux": {
    "uidMappings": [
      {
        "containerID": 0,     // ì»¨í…Œì´ë„ˆ UID 0 (root)
        "hostID": 100000,     // â†’ í˜¸ìŠ¤íŠ¸ UID 100000
        "size": 65536         // 65536ê°œ UID ë§¤í•‘
      }
    ],
    "gidMappings": [
      {
        "containerID": 0,
        "hostID": 100000,
        "size": 65536
      }
    ]
  }
}
```

**ë™ì‘ í™•ì¸:**
```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (sudo ì—†ì´)
runc run -d rootless-test

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€: rootë¡œ ë³´ì„
runc exec rootless-test id
# uid=0(root) gid=0(root)

# í˜¸ìŠ¤íŠ¸ì—ì„œ í™•ì¸: ì‹¤ì œë¡œëŠ” ì¼ë°˜ ì‚¬ìš©ì
ps aux | grep runc
# username  12345  ... runc
```

**ë³´ì•ˆ ì¥ì :**
- ì»¨í…Œì´ë„ˆ íƒˆì¶œ ì‹œì—ë„ ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œë§Œ íšë“
- í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œ íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ ì œí•œ
- ë©€í‹°í…Œë„ŒíŠ¸ í™˜ê²½ì—ì„œ ì•ˆì „

**ì œì•½ì‚¬í•­:**
- Privileged port (1-1023) ì‚¬ìš© ë¶ˆê°€
- ì¼ë¶€ Cgroup ì œí•œ ë¶ˆê°€ (cgroup v2 í•„ìš”)
- ë„¤íŠ¸ì›Œí¬ ì„¤ì • ì œí•œ (slirp4netns ì‚¬ìš©)

</details>

### ë¬¸ì œ 3: config.jsonì˜ "hooks"ëŠ” ì–´ë–¤ ìƒí™©ì—ì„œ í™œìš©ë˜ëŠ”ê°€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

HooksëŠ” ì»¨í…Œì´ë„ˆ ìƒëª…ì£¼ê¸°ì˜ íŠ¹ì • ì‹œì ì— **ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

**Hook íƒ€ì…ê³¼ íƒ€ì´ë°:**
```
Container Lifecycle:

create
  â”œâ”€ Namespace, Cgroup ìƒì„±
  â”œâ”€ rootfs ë§ˆìš´íŠ¸
  â”‚
  â”œâ”€ [prestart hook] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì—¬ê¸°!
  â”‚   ì‹¤í–‰ ì˜ˆ: ë„¤íŠ¸ì›Œí¬ ì„¤ì •
  â”‚
  â””â”€ Created ìƒíƒœ

start
  â”œâ”€ [createRuntime hook] â—„â”€â”€â”€â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ìƒì„± ì§ì „
  â”‚   ì‹¤í–‰ ì˜ˆ: ë³´ì•ˆ ì •ì±… ì ìš©
  â”‚
  â”œâ”€ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (execve)
  â”‚
  â”œâ”€ [createContainer hook] â—„â”€â”€â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ìƒì„± ì§í›„
  â”œâ”€ [startContainer hook] â—„â”€â”€â”€â”€â”€â”€ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ ì§í›„
  â”‚
  â””â”€ Running ìƒíƒœ

(ì»¨í…Œì´ë„ˆ ì‹¤í–‰...)

kill / exit
  â”œâ”€ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
  â”‚
  â”œâ”€ [poststop hook] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¢…ë£Œ í›„
  â”‚   ì‹¤í–‰ ì˜ˆ: ë¡œê·¸ ìˆ˜ì§‘, ì •ë¦¬
  â”‚
  â””â”€ Stopped ìƒíƒœ
```

**ì‹¤ì œ ì‚¬ìš© ì˜ˆ:**

1. **CNI (Container Network Interface) - prestart:**
```json
{
  "hooks": {
    "prestart": [
      {
        "path": "/opt/cni/bin/bridge",
        "args": ["bridge", "ADD", "container-id"],
        "env": ["CNI_COMMAND=ADD", "CNI_IFNAME=eth0"]
      }
    ]
  }
}
```
- ì»¨í…Œì´ë„ˆì— ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
- containerd, Kubernetesê°€ ì‚¬ìš©

2. **ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ - poststop:**
```json
{
  "hooks": {
    "poststop": [
      {
        "path": "/usr/local/bin/collect-logs.sh",
        "args": ["collect-logs.sh", "container-id"]
      }
    ]
  }
}
```
- ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ì‹œ ë¡œê·¸ ìˆ˜ì§‘
- ë©”íŠ¸ë¦­ ì „ì†¡

3. **ë³´ì•ˆ ì •ì±… ì ìš© - createRuntime:**
```json
{
  "hooks": {
    "createRuntime": [
      {
        "path": "/usr/local/bin/apply-selinux.sh",
        "args": ["apply-selinux.sh"]
      }
    ]
  }
}
```
- SELinux ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
- AppArmor í”„ë¡œíŒŒì¼ ì ìš©

**Hook ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ:**
```bash
#!/bin/bash
# prestart-network.sh

CONTAINER_ID=$1
CONTAINER_PID=$(cat /var/run/container/$CONTAINER_ID/pid)

# veth pair ìƒì„±
ip link add veth0 type veth peer name veth1

# veth1ì„ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ namespaceë¡œ ì´ë™
ip link set veth1 netns $CONTAINER_PID

# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ eth0ë¡œ rename
nsenter -t $CONTAINER_PID -n ip link set veth1 name eth0
nsenter -t $CONTAINER_PID -n ip addr add 192.168.1.2/24 dev eth0
nsenter -t $CONTAINER_PID -n ip link set eth0 up

# í˜¸ìŠ¤íŠ¸ ì¸¡ veth0 ì„¤ì •
ip link set veth0 up
ip link set veth0 master br0
```

**Hook ì‹¤í–‰ ê·œì¹™:**
- ìˆœì„œëŒ€ë¡œ ì‹¤í–‰
- ì‹¤íŒ¨ ì‹œ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹¤íŒ¨ (prestart, createRuntime)
- Timeout ì„¤ì • ê°€ëŠ¥
- stdinìœ¼ë¡œ container state JSON ì „ë‹¬

**ì‹¤ë¬´ í™œìš©:**
- Kubernetes CNI í”ŒëŸ¬ê·¸ì¸
- ì„œë¹„ìŠ¤ ë©”ì‹œ (Istio, Linkerd) ì‚¬ì´ë“œì¹´ ì£¼ì…
- ë¡œê¹… ì—ì´ì „íŠ¸ (Fluentd, Filebeat)
- ë³´ì•ˆ ì •ì±… (SELinux, AppArmor)

</details>

---

## ğŸ“Œ í•µì‹¬ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°œë…               â”‚ ì„¤ëª…                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc              â”‚ OCI Runtime Spec ì°¸ì¡° êµ¬í˜„             â”‚
â”‚                   â”‚ ì‹¤ì œ ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OCI Bundle        â”‚ config.json + rootfs/                â”‚
â”‚                   â”‚ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì„ ìœ„í•œ ìµœì†Œ ë‹¨ìœ„              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ config.json       â”‚ ëŸ°íƒ€ì„ ì„¤ì • íŒŒì¼                         â”‚
â”‚                   â”‚ Process, Namespace, Cgroup, Hooks    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rootfs            â”‚ ì»¨í…Œì´ë„ˆì˜ ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ                  â”‚
â”‚                   â”‚ ì´ë¯¸ì§€ ë ˆì´ì–´ë¥¼ í•©ì¹œ ê²°ê³¼                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Lifecycle         â”‚ create â†’ start â†’ kill â†’ delete       â”‚
â”‚                   â”‚ run = create + start í•œ ë²ˆì—           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Namespace         â”‚ PID, NET, MNT, UTS, IPC, CGROUP      â”‚
â”‚                   â”‚ í”„ë¡œì„¸ìŠ¤/ë¦¬ì†ŒìŠ¤ ê²©ë¦¬                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cgroup            â”‚ CPU, Memory, I/O ì œí•œ                 â”‚
â”‚                   â”‚ /sys/fs/cgroupì— ì ìš©                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hooks             â”‚ prestart, poststart, poststop        â”‚
â”‚                   â”‚ ìƒëª…ì£¼ê¸° ì´ë²¤íŠ¸ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rootless          â”‚ User Namespaceë¡œ ë¹„íŠ¹ê¶Œ ì‹¤í–‰            â”‚
â”‚                   â”‚ UID/GID ë§¤í•‘, ë³´ì•ˆ ê°•í™”                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

runc ì‹¤í–‰ íë¦„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. config.json íŒŒì‹±                                 â”‚
â”‚ 2. Linux Namespace ìƒì„± (PID, NET, MNT, ...)        â”‚
â”‚ 3. Cgroup ì„¤ì • (ë¦¬ì†ŒìŠ¤ ì œí•œ)                           â”‚
â”‚ 4. rootfs ë§ˆìš´íŠ¸ (OverlayFS ë“±)                      â”‚
â”‚ 5. Capabilities ì„¤ì • (ê¶Œí•œ ì œí•œ)                      â”‚
â”‚ 6. Seccomp í•„í„° ì ìš© (ì‹œìŠ¤í…œ ì½œ ì œí•œ)                   â”‚
â”‚ 7. prestart hooks ì‹¤í–‰                              â”‚
â”‚ 8. clone() ì‹œìŠ¤í…œ ì½œ (ìƒˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±)                  â”‚
â”‚ 9. execve() (ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰)                    â”‚
â”‚ 10. poststart hooks ì‹¤í–‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [runc GitHub](https://github.com/opencontainers/runc)
- [OCI Runtime Specification](https://github.com/opencontainers/runtime-spec/blob/main/spec.md)
- [runc Man Pages](https://github.com/opencontainers/runc/blob/main/man/)
- [rootless Containers](https://rootlesscontaine.rs/)
- [Linux Namespaces](https://man7.org/linux/man-pages/man7/namespaces.7.html)
- [Cgroups v2](https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html)
- [Seccomp](https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt)

---

## ğŸ¤” ìƒê°í•´ë³¼ ë¬¸ì œ

1. Dockerë‚˜ containerd ì—†ì´ runcë§Œìœ¼ë¡œ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ìš´ì˜í•  ìˆ˜ ìˆì„ê¹Œ? ë¬´ì—‡ì´ ë¶€ì¡±í• ê¹Œ?
2. rootless ì»¨í…Œì´ë„ˆê°€ ì¼ë°˜ ì»¨í…Œì´ë„ˆë³´ë‹¤ ë” ì•ˆì „í•œ ì´ìœ ëŠ”? ì–´ë–¤ ê³µê²© ë²¡í„°ë¥¼ ë§‰ì„ ìˆ˜ ìˆëŠ”ê°€?
3. OCI Bundleì˜ config.jsonì´ Dockerfileì˜ ì–´ë–¤ ì§€ì‹œì–´ë“¤ê³¼ ëŒ€ì‘ë˜ëŠ”ê°€?

> ğŸ’¡ **ë‹µë³€**:
> 
> **1) runcë§Œìœ¼ë¡œ í”„ë¡œë•ì…˜ ìš´ì˜:**
> 
> **ê°€ëŠ¥í•˜ì§€ë§Œ ë§ì€ ê²ƒì„ ìˆ˜ë™ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•¨:**
> - âŒ **ì´ë¯¸ì§€ ê´€ë¦¬**: Pull/push, ë ˆì´ì–´ ìºì‹±, ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—†ìŒ
> - âŒ **ë„¤íŠ¸ì›Œí¬**: CNI í”ŒëŸ¬ê·¸ì¸ ìˆ˜ë™ ê´€ë¦¬, DNS, Service discovery ì—†ìŒ
> - âŒ **ìŠ¤í† ë¦¬ì§€**: ë³¼ë¥¨ ê´€ë¦¬, Persistent storage ì—†ìŒ
> - âŒ **ë¡œê¹…**: ì»¨í…Œì´ë„ˆ ë¡œê·¸ ìˆ˜ì§‘/ê´€ë¦¬ ì—†ìŒ
> - âŒ **ëª¨ë‹ˆí„°ë§**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘, Health check ì—†ìŒ
> - âŒ **ì¬ì‹œì‘ ì •ì±…**: ì»¨í…Œì´ë„ˆ ìë™ ì¬ì‹œì‘ ì—†ìŒ
> - âŒ **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: ìŠ¤ì¼€ì¤„ë§, ë¡œë“œë°¸ëŸ°ì‹±, Auto-scaling ì—†ìŒ
> 
> runcëŠ” **"ì»¨í…Œì´ë„ˆ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰"**ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ëŠ” containerd + orchestrator (Kubernetes, Swarm) í•„ìš”.
> 
> **2) rootless ì»¨í…Œì´ë„ˆì˜ ë³´ì•ˆ:**
> 
> **ë§‰ì„ ìˆ˜ ìˆëŠ” ê³µê²©:**
> ```
> ì¼ë°˜ ì»¨í…Œì´ë„ˆ:
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚ Container (root)         â”‚  ì»¨í…Œì´ë„ˆ íƒˆì¶œ ì‹œ
> â”‚ - UID 0                  â”‚      â†“
> â”‚ - ì œí•œëœ capabilities      â”‚  í˜¸ìŠ¤íŠ¸ root ê¶Œí•œ íšë“ ê°€ëŠ¥
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  (ì‹¬ê°í•œ ë³´ì•ˆ ìœ„í—˜!)
> 
> rootless ì»¨í…Œì´ë„ˆ:
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚ Container (fake root)    â”‚  ì»¨í…Œì´ë„ˆ íƒˆì¶œ ì‹œ
> â”‚ - ì»¨í…Œì´ë„ˆ: UID 0          â”‚      â†“
> â”‚ - í˜¸ìŠ¤íŠ¸: UID 100000       â”‚  ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œë§Œ íšë“
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  (ì œí•œì  í”¼í•´)
> ```
> 
> **ì°¨ë‹¨ë˜ëŠ” ê³µê²© ë²¡í„°:**
> - ì»¤ë„ ì·¨ì•½ì  ì•…ìš© (CVE-2019-5736 runc íƒˆì¶œ)
> - Privileged port bind (< 1024)
> - í˜¸ìŠ¤íŠ¸ íŒŒì¼ ìˆ˜ì • (root ì†Œìœ  íŒŒì¼)
> - ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í”„ë¡œì„¸ìŠ¤ ì¡°ì‘
> - ì‹œìŠ¤í…œ ë°ëª¬ ì¡°ì‘ (systemd, sshd)
> 
> **ë©€í‹°í…Œë„ŒíŠ¸ í™˜ê²½ì—ì„œ í•„ìˆ˜:**
> ì„œë¡œ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì»¨í…Œì´ë„ˆê°€ ê°™ì€ í˜¸ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë  ë•Œ, rootless ì»¨í…Œì´ë„ˆëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ë¶ˆê°€.
> 
> **3) config.json â†” Dockerfile ë§¤í•‘:**
> 
> ```
> Dockerfile                          config.json
> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
> FROM alpine:3.18                â†’  rootfs/ (ì´ë¯¸ì§€ ë ˆì´ì–´)
> 
> WORKDIR /app                    â†’  "process.cwd": "/app"
> 
> ENV PATH=/usr/bin:...           â†’  "process.env": [
>                                      "PATH=/usr/bin:..."
>                                    ]
> 
> USER 1000:1000                  â†’  "process.user": {
>                                      "uid": 1000,
>                                      "gid": 1000
>                                    }
> 
> EXPOSE 8080                     â†’  (ì£¼ì„ë§Œ, ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ëŠ” ë³„ë„)
> 
> VOLUME /data                    â†’  "mounts": [
>                                      {
>                                        "destination": "/data",
>                                        "source": "...",
>                                        "type": "bind"
>                                      }
>                                    ]
> 
> CMD ["python", "app.py"]        â†’  "process.args": [
>                                      "python", "app.py"
>                                    ]
> 
> ENTRYPOINT ["/entrypoint.sh"]   â†’  "process.args": [
>                                      "/entrypoint.sh",
>                                      ...CMD...
>                                    ]
> 
> (Docker runtime ì˜µì…˜)
> docker run --memory=512m        â†’  "linux.resources.memory.limit":
>                                      536870912
> 
> docker run --cpus=2             â†’  "linux.resources.cpu.quota":
>                                      200000
> ```
> 
> **Dockerfileì€ ì´ë¯¸ì§€ ë¹Œë“œ ì‹œì , config.jsonì€ ëŸ°íƒ€ì„ ì‹œì **ì˜ ì„¤ì •ì…ë‹ˆë‹¤. DockerëŠ” ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„°ì™€ ëŸ°íƒ€ì„ ì˜µì…˜ì„ ê²°í•©í•˜ì—¬ config.jsonì„ ìƒì„±í•©ë‹ˆë‹¤.

---

<div align="center">

**[â¬…ï¸ ì´ì „: containerd](./03-containerd.md)** | **[ë‹¤ìŒ: Docker API â¡ï¸](./05-Docker-API.md)**

</div>
